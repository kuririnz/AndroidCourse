<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>蔵書詳細画面作成 | Android programing getstart</title><link rel="stylesheet" type="text/css" href="/AndroidCourse//css/normalize.css"><link rel="stylesheet" type="text/css" href="/AndroidCourse//css/highlight.css"><link rel="stylesheet" type="text/css" href="/AndroidCourse//css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="../../favicon.ico"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="../../." class="title">Android programing getstart</a><span class="subtitle"></span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="../../index.html" class="sidebar-nav-item">Home</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>蔵書詳細画面作成</h1></div></div>
<article><div class="container post"><p>蔵書詳細画面を作成する中でモデルクラスとFragmentの実装を学習します。</p>
<!-- toc -->
<ul>
<li><a href="#学習ポイント">学習ポイント</a></li>
<li><a href="#検索結果一覧画面の構築移行">検索結果一覧画面の構築移行</a><ul>
<li><a href="#fragmentとは">Fragmentとは</a></li>
<li><a href="#検索結果一覧fragment作成">検索結果一覧Fragment作成</a></li>
<li><a href="#検索結果一覧画面レイアウト実装">検索結果一覧画面レイアウト実装</a><ul>
<li><a href="#framelayout-コンポーネント">FrameLayout コンポーネント</a></li>
</ul>
</li>
<li><a href="#検索結果一覧fragment機能実装">検索結果一覧Fragment機能実装</a></li>
<li><a href="#定数">定数</a></li>
<li><a href="#context概要">Context概要</a></li>
</ul>
</li>
<li><a href="#蔵書詳細画面作成">蔵書詳細画面作成</a></li>
<li><a href="#蔵書詳細画面遷移実装">蔵書詳細画面遷移実装</a></li>
<li><a href="#蔵書詳細画面実装">蔵書詳細画面実装</a><ul>
<li><a href="#for-each">for-each</a></li>
<li><a href="#url画像読み込み処理の実装">URL画像読み込み処理の実装</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<p><a href="/AndroidCourse/android/08-AppDataBase">検索履歴一覧画面の作成</a>からの引き続きの学習ページです。</p>
<h1><span id="学習ポイント">学習ポイント</span></h1><ul>
<li>Fragment</li>
<li>Fragmentによる画面遷移</li>
<li>定数</li>
<li>Gson</li>
<li>Glide</li>
</ul>
<p>複数のデータをひとまとめにして管理するための方法としてモデルクラスを学習します。<br>また、検索結果一覧画面の各蔵書ごとの詳細情報を表示する蔵書詳細画面を作成し、遷移できるように修正していきます、その工程の中でActivity内に配置できるライフサイクルを持ったViewコンポーネント<strong>Fragment</strong>の利用方法と<strong>Fragment</strong>間の画面遷移に関して学習します。</p>
<h1><span id="検索結果一覧画面の構築移行">検索結果一覧画面の構築移行</span></h1><p><a href="/AndroidCourse/android/06-TransitionScreen">検索結果一覧画面の作成</a>ページでActivityを使い画面実装を行なっていましたが、これをそっくり<strong>Fragment</strong>を利用した実装に書き換えます。<br>さらに、複数表示されている検索結果一覧からクリックされた行の蔵書の詳細情報を表示する画面、”蔵書詳細画面”を<strong>Fragment</strong>で実装しこの画面に遷移するようアプリを作り変えていきます。</p>
<h2><span id="fragmentとは">Fragmentとは</span></h2><p>FragmentはActivityのようにライフサイクルを持ったViewコンポーネントにあたり、ButtonやListViewなど複数のWidgetやViewを配置することが可能です、またActivity内に複数のFragmentを表示することができるので画面分割の必要な機能を作成する時には活躍が期待されます。</p>
<p>また、<strong>Fragment</strong>を利用するメリットはActivityに比べてAndroid端末が画面表示するコストが小さくなるため、アプリの強制終了のリスクを多少回避できることも上げられます。</p>
<p>逆に<strong>Fragment</strong>の利用にあたり注意しなければいけないのはActivityとは別のライフサイクルになるため、Activityがすでに存在しないタイミングで<strong>Fragment</strong>のライフサイクルメソッドが実行され強制終了する可能性があります。<br>また、<strong>Fragment</strong>自身はContextとしての要素は持ち合わせていないため、ActivityやApplicationクラスからContextを取得するなどしてレイアウト表示を実装する必要があります。</p>
<p>ではまず、検索結果一覧画面を<strong>Fragment</strong>を使った実装に作り変えていきます。</p>
<h2><span id="検索結果一覧fragment作成">検索結果一覧Fragment作成</span></h2><p>新しくFragmentクラスを継承した独自クラスのjavaファイルを作成していきます。</p>
<p>検索結果画面の時と同様にメニューもしくはプロジェクトツリーが表示されているウィンドウで右クリック(macでは２本指でクリック)から以下の項目を選択します。</p>
<blockquote>
<p>New -&gt; Fragment -&gt; Fragment(Blank)</p>
</blockquote>
<img src="/AndroidCourse/android/09-RefactorFragment/addfragment01.png" width="500" title="Create New Fragment">
<p>新しいFragmentクラスを作成する時の設定項目は以下の通り入力したら<code>Finish</code>をクリックします。<br><img src="/AndroidCourse/android/09-RefactorFragment/addfragment02.png" width="500" title="Create New Fragment"></p>
<table>
<thead>
<tr>
<th>項目</th>
<th>設定値</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fragment Name</td>
<td>ResultListFragment</td>
</tr>
<tr>
<td>Create Layout XML?</td>
<td>チェックを<font color="blue">つける</font></td>
</tr>
<tr>
<td>Fragment Layout Name</td>
<td>fragment_result_list</td>
</tr>
<tr>
<td>Include fragment factory methods?</td>
<td>チェックを<font color="red">つけない</font></td>
</tr>
<tr>
<td>Include interface callbacks?</td>
<td>チェックを<font color="red">つけない</font></td>
</tr>
<tr>
<td>Source Language</td>
<td>Java</td>
</tr>
</tbody>
</table>
<p>新しく<code>ResultListFragment.java</code>と<code>fragment_result_list.xml</code>の2ファイルが作成されます。<br><img src="/AndroidCourse/android/09-RefactorFragment/addfragment03.png" width="600" title="Create New Fragment"></p>
<h2><span id="検索結果一覧画面レイアウト実装">検索結果一覧画面レイアウト実装</span></h2><p>作成した<code>fragment_resultlist.xml</code>と<code>activity_result_list.xml</code>を編集します。<br><code>fragment_result_list.xml</code>のファイルの場所は以下です。</p>
<blockquote>
<p>app -&gt; res -&gt; layou -&gt; fragment_result_list.xml</p>
</blockquote>
<p><code>feagment_result_list.xml</code>を表示した時に<strong>LayoutEditor</strong>が表示されたら左下の”Text”タブをクリックしxmlでの編集画面に表示を切り替えます。<br><img src="/AndroidCourse/android/09-RefactorFragment/editRLfrg01.png" width="600" title="Edit Result List Fragment"><br><figure class="highlight xml"><figcaption><span>fragment_result_list.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">"kuririnz.xyz.bookdiscovery.ResultListFragment"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ↓↓↓↓↓↓↓↓↓↓修正↓↓↓↓↓↓↓↓↓↓ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/FragmentResultListView"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_margin</span>=<span class="string">"8dp"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ↑↑↑↑↑↑↑↑↑↑修正↑↑↑↑↑↑↑↑↑↑ --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>一覧表示用の”ListView”を配置して画面いっぱいに表示されるように設定します。<br>次にFragmentを表示するactivityのレイアウトを修正していきます。</p>
<blockquote>
<p>app -&gt; res -&gt; layou -&gt; activity_result_list.xml</p>
</blockquote>
<p>上記レイアウトファイルを表示し、右下の”Design”タブをクリックします。<br><img src="/AndroidCourse/android/09-RefactorFragment/migratefrg01.png" width="600" title="Edit Result List Activity"><br>デザインビューに表示されている<code>ResultListView</code>をクリックし、<kbd>delete</kbd>キーを押下して削除します。<br>何も表示されていない状態になったら、<code>Palette -&gt; Layouts -&gt; FrameLayout</code>から”FrameLayout”をドラッグ&amp;ドロップでデザインビューに表示します。<br><img src="/AndroidCourse/android/09-RefactorFragment/migratefrg02.png" width="600" title="Edit Result List Activity"><br>制約と属性の設定を行います。<br><img src="/AndroidCourse/android/09-RefactorFragment/migratefrg03.png" width="600" title="Edit Result List Activity"> </p>
<p><strong>FrameLayout</strong>に設定する制約</p>
<table>
<thead>
<tr>
<th style="text-align:left">FrameLayoutの辺</th>
<th style="text-align:left">隣り合わせる箇所</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">上辺</td>
<td style="text-align:left">画面上端</td>
</tr>
<tr>
<td style="text-align:left">左辺</td>
<td style="text-align:left">画面左端</td>
</tr>
<tr>
<td style="text-align:left">下辺</td>
<td style="text-align:left">画面下端</td>
</tr>
<tr>
<td style="text-align:left">右辺</td>
<td style="text-align:left">画面右端</td>
</tr>
</tbody>
</table>
<p><strong>FrameLayout</strong>に設定する属性</p>
<table>
<thead>
<tr>
<th>設定項目</th>
<th>設定値</th>
</tr>
</thead>
<tbody>
<tr>
<td>ID</td>
<td>FragmentContainer</td>
</tr>
<tr>
<td>layout_width</td>
<td>match_constraint</td>
</tr>
<tr>
<td>layout_height</td>
<td>match_constraint</td>
</tr>
</tbody>
</table>
<p>これでレイアウトファイルの修正は完了です。</p>
<h3><span id="framelayout-コンポーネント">FrameLayout コンポーネント</span></h3><p>先ほどの実装で初めて出てきたコンポーネント”FrameLayout”です。<br>“FrameLayout”はAndroid SDKがリリースされた時からある古いコンポーネントです。<br>他の”ConstraintLayout”や”LinearLayout”、”RelativeLayout”などには子Viewを配置する上での便利な特徴がありますが、”FrameLayout”は特徴がないことが特徴となります。<br>“FrameLayout”での子View配置は左上の角を横/縦の基準(0,0)として正確にポイントを設定して期待する位置に配置する必要があるため、複数のコンポーネント同士を関連付けて配置するのが難しくなります。<br>また、Androidでポイントを指定して配置を行うと、数多く販売されているAndroid端末の全画面サイズに対応仕切れず、レイアウト崩れの原因になってしまうので表示するコンポーネントの少ない場合など細かい配置のないような場合で用いられます。</p>
<h2><span id="検索結果一覧fragment機能実装">検索結果一覧Fragment機能実装</span></h2><p>レイアウトの修正が終わりましたので<code>ResultListFragment.java</code>、<code>ResultListActivity.java</code>ファイルを実装します。<br><code>ResultListFragment.java</code>の実装ほとんどが<code>ResultListActivity.java</code>のプログラムをコピーするだけで問題ないのですが、一部細かい違いがあるのでコピーしてエラーになった箇所など見比べて確認してみてください。</p>
<p>まずFragmentクラスに少し手を加えていきます。<br><code>ResultListFragment.java</code>のクラス宣言より上に表示されている<code>import..</code>の一覧から<br><em>import android.app.Fragment;</em>を削除します。<br><img src="/AndroidCourse/android/09-RefactorFragment/chngimport01.png" width="600" title="Import Change"><br>次に<font color="red">赤くなった<code>Fragmet</code></font>をクリックし上に表示されるツールチップに従い<br><kbd>Alt</kbd><kbd>+</kbd><kbd>Enter</kbd>(Macは<kbd>option</kbd><kbd>+</kbd><kbd>Enter</kbd>)を入力<br><img src="/AndroidCourse/android/09-RefactorFragment/chngimport02.png" width="600" title="Import Change"><br>ウィンドウに選択肢が表示されたら<strong>Fragment (android.support.v4.app)</strong>を選択します。<br><img src="/AndroidCourse/android/09-RefactorFragment/chngimport03.png" width="600" title="Import Change"> </p>
<p>Android SDK上にはFragmentクラスが２種類あります。</p>
<ul>
<li>android.app.Fragment</li>
<li>android.support.v4.app.Fragment</li>
</ul>
<p>Google者からは後者の”android.support.v4.app.Fragment”の使用を推奨されています。<br>大きは違いとしてAndroid API 16(OS 4.1)以下にもアプリを配信する場合は”android.support.v4.app.Fragment”をimportしてFragmentを使用する必要があります。</p>
<p>その他の違いとしては以下の通りです。</p>
<ul>
<li>android.support.v4.app.Fragmentの方がバグが少ない。</li>
<li>android.app.Fragmentでは一部メソッドが使えない。</li>
</ul>
<p>実装中今までほとんど触れてこなかったimportエリアですが、この部分にはクラス内で利用している外部のクラスを指定する必要があり、ここに対象のクラスがインポートされていないとクラス内部の実装で使用することができません、実装する上で必要なクラスはここで全てインポートします。<br>候補検索など小さなウィンドウから選択して実装する場合は自動的にインポートされるのであまり気にしないでプログラミングして問題ありません。</p>
<p>では機能の実装を進めていきます。<br><figure class="highlight java"><figcaption><span>ResultListFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓修正↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultListFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> <span class="keyword">implements</span> <span class="title">AdapterView</span>.<span class="title">OnItemClickListener</span> </span>&#123;</span><br><span class="line"><span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑修正↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="comment">// 定数</span></span><br><span class="line">    <span class="comment">// データ渡しのキー情報</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String BUNDLE_KEY = <span class="string">"BUNDLE_TERM"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// xmlファイルのコンポーネントと関連付ける要素</span></span><br><span class="line">    <span class="keyword">private</span> ListView resultListView;</span><br><span class="line">    <span class="comment">// ListViewの表示内容を管理するクラス</span></span><br><span class="line">    <span class="keyword">private</span> ResultListAdapter adapter;</span><br><span class="line">    <span class="comment">// OkHttp通信クライアント</span></span><br><span class="line">    <span class="keyword">private</span> OkHttpClient okHttpClient;</span><br><span class="line">    <span class="comment">// メインスレッドに戻ってくるためのHandler</span></span><br><span class="line">    <span class="keyword">private</span> Handler handler;</span><br><span class="line">    <span class="comment">// MainActivityから渡されたデータを保持する</span></span><br><span class="line">    <span class="keyword">private</span> String term;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// スタティックコンストラクタ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ResultListFragment <span class="title">getInstance</span><span class="params">(String term)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ResultListFragmentインスタンスを生成</span></span><br><span class="line">        ResultListFragment fragment = <span class="keyword">new</span> ResultListFragment();</span><br><span class="line">        <span class="comment">// ResultListFragmentに渡すデータ格納クラスを生成</span></span><br><span class="line">        Bundle args = <span class="keyword">new</span> Bundle();</span><br><span class="line">        <span class="comment">// 検索文字列データを連携データにセット</span></span><br><span class="line">        args.putString(BUNDLE_KEY, term);</span><br><span class="line">        <span class="comment">// データ格納クラスをResultListFragmentインスタンスにセット</span></span><br><span class="line">        fragment.setArguments(args);</span><br><span class="line">        <span class="comment">// 生成したResultListFragmentを返却</span></span><br><span class="line">        <span class="keyword">return</span> fragment;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// コンストラクタ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ResultListFragment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Required empty public constructor</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fragmentが表示するレイアウトを指定するライフサイクルメソッド</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container,</span></span></span><br><span class="line"><span class="function"><span class="params">                             Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Inflate the layout for this fragment</span></span><br><span class="line">        <span class="keyword">return</span> inflater.inflate(R.layout.fragment_result_list, container, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="comment">// 親となるActivityが生成された後に実行されるライフサイクルメソッド</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityCreated</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onActivityCreated(savedInstanceState);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Handlerをインスタンス化</span></span><br><span class="line">        handler = <span class="keyword">new</span> Handler();</span><br><span class="line">        <span class="comment">// 検索文字列変数を初期化</span></span><br><span class="line">        term = <span class="string">"Android"</span>;</span><br><span class="line">        <span class="comment">// 連携データが存在するか確認</span></span><br><span class="line">        <span class="keyword">if</span> (getArguments() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 連携データ内から"term"キーのデータを代入、なければ"Android"と文字列を代入</span></span><br><span class="line">            term = getArguments().getString(BUNDLE_KEY, <span class="string">"Android"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// xmlファイルのコンポーネントと関連付け</span></span><br><span class="line">        resultListView =  getView().findViewById(R.id.FragmentResultListView);</span><br><span class="line">        <span class="comment">// OkHttp通信クライアントをインスタンス化</span></span><br><span class="line">        okHttpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line">        <span class="comment">// 通信するための情報</span></span><br><span class="line">        <span class="comment">// MainActivityで入力された文字列で検索する様修正</span></span><br><span class="line">        Request request = <span class="keyword">new</span> Request.Builder().url(<span class="string">"https://www.googleapis.com/books/v1/volumes?q="</span> + term).build();</span><br><span class="line">        <span class="comment">// データの取得後の命令を実装</span></span><br><span class="line">        Callback callBack = <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 失敗した時の命令</span></span><br><span class="line">                <span class="comment">// 通信に失敗した原因をログに出力</span></span><br><span class="line">                Log.e(<span class="string">"failure API Response"</span>, e.getLocalizedMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="comment">// 成功した時の命令</span></span><br><span class="line">                <span class="comment">// Google Books APIから取得したデータをログに出力</span></span><br><span class="line">                <span class="comment">// Jsonのパースが失敗してアプリの強制終了を回避する機能</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// JsonデータをJSONObjectに変換</span></span><br><span class="line">                    JSONObject rootJson = <span class="keyword">new</span> JSONObject(response.body().string());</span><br><span class="line">                    <span class="comment">// Jsonデータから蔵書リストデータ"items"を取得</span></span><br><span class="line">                    JSONArray items = rootJson.getJSONArray(<span class="string">"items"</span>);</span><br><span class="line">                    Log.d(<span class="string">"Success API Response"</span>, <span class="string">"APIから取得したデータの件数:"</span> +</span><br><span class="line">                            items.length());</span><br><span class="line">                    <span class="comment">// メインスレッドで実行する処理をインスタンス化</span></span><br><span class="line">                    ReflectResult reflectResult = <span class="keyword">new</span> ReflectResult(items);</span><br><span class="line">                    <span class="comment">// Handlerにてメインスレッドに処理を戻し、ReflectResultのrunメソッドを実行する</span></span><br><span class="line">                    handler.post(reflectResult);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">                    <span class="comment">// Jsonパースの時にエラーが発生したらログに出力する</span></span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 非同期処理でAPI通信を実行</span></span><br><span class="line">        okHttpClient.newCall(request).enqueue(callBack);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ListViewの各行をクリックした時の命令を実装</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; adapterView, View view, <span class="keyword">int</span> i, <span class="keyword">long</span> l)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// クリックした行番号をToastで表示する</span></span><br><span class="line">        Toast.makeText(getContext()</span><br><span class="line">                , (i + <span class="number">1</span>) + <span class="string">"行目をクリックしました"</span></span><br><span class="line">                , Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 検索結果をListViewに反映するメインスレッドの処理クラス</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectResult</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 蔵書一覧タイトルデータリスト</span></span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; titleList;</span><br><span class="line">        <span class="comment">// 蔵書一覧概要データリスト</span></span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; summaryList;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// コンストラクタ</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ReflectResult</span><span class="params">(JSONArray items)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// リストデータを初期化</span></span><br><span class="line">            titleList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            summaryList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="comment">// Jsonのパースエラーが発生した時に備えてtry~catchする</span></span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="comment">// 蔵書リストの件数分繰り返しタイトルをログ出力する</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; items.length(); i ++) &#123;</span><br><span class="line">                    <span class="comment">// 蔵書リストから i番目のデータを取得</span></span><br><span class="line">                    JSONObject item = items.getJSONObject(i);</span><br><span class="line">                    <span class="comment">// 蔵書のi番目データから蔵書情報のグループを取得</span></span><br><span class="line">                    JSONObject volumeInfo = item.getJSONObject(<span class="string">"volumeInfo"</span>);</span><br><span class="line">                    <span class="comment">// タイトルデータをリストに追加</span></span><br><span class="line">                    titleList.add(volumeInfo.getString(<span class="string">"title"</span>));</span><br><span class="line">                    <span class="comment">// 概要データをリストに追加</span></span><br><span class="line">                    summaryList.add(volumeInfo.getString(<span class="string">"description"</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Handlerから実行されるメソッド</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// ListViewに表示する情報をまとめるAdapterをインスタンス化</span></span><br><span class="line">            adapter = <span class="keyword">new</span> ResultListAdapter(getContext(), titleList, summaryList);</span><br><span class="line">            <span class="comment">// ListViewに表示情報をまとめたAdapterをセット</span></span><br><span class="line">            resultListView.setAdapter(adapter);</span><br><span class="line">            <span class="comment">// ListViewに行をクリックした時のイベントを登録</span></span><br><span class="line">            resultListView.setOnItemClickListener(ResultListFragment.<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><figcaption><span>ResultListActivity.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓修正↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultListActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"><span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑修正↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓削除↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="comment">// xmlファイルのコンポーネントと関連付ける要素</span></span><br><span class="line">    <span class="keyword">private</span> ListView resultListView;</span><br><span class="line">    <span class="comment">// ListViewの表示内容を管理するクラス</span></span><br><span class="line">    <span class="keyword">private</span> ResultListAdapter adapter;</span><br><span class="line">    <span class="comment">// OkHttp通信クライアント</span></span><br><span class="line">    <span class="keyword">private</span> OkHttpClient okHttpClient;</span><br><span class="line">    <span class="comment">// メインスレッドに戻ってくるためのHandler</span></span><br><span class="line">    <span class="keyword">private</span> Handler handler;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑削除↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">    <span class="comment">// MainActivityから渡されたデータを保持する</span></span><br><span class="line">    <span class="keyword">private</span> String term;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_result_list);</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓削除↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">        <span class="comment">// Handlerをインスタンス化</span></span><br><span class="line">        handler = <span class="keyword">new</span> Handler();</span><br><span class="line">        <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑削除↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">        <span class="comment">// 画面遷移時のデータが空でない場合</span></span><br><span class="line">        <span class="keyword">if</span> (getIntent().hasExtra(<span class="string">"terms"</span>)) &#123;</span><br><span class="line">            <span class="comment">// Key:termsにデータがあればValueを代入</span></span><br><span class="line">            term = getIntent().getStringExtra(<span class="string">"terms"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 画面遷移時のデータがからの場合は "Android"と文字列を代入</span></span><br><span class="line">            term = <span class="string">"Android"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓削除↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">        <span class="comment">// xmlファイルのコンポーネントと関連付け</span></span><br><span class="line">        resultListView = findViewById(R.id.ResultListView);</span><br><span class="line">        <span class="comment">// OkHttp通信クライアントをインスタンス化</span></span><br><span class="line">        okHttpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line">        <span class="comment">// 通信するための情報</span></span><br><span class="line">        <span class="comment">// MainActivityで入力された文字列で検索する様修正</span></span><br><span class="line">        Request request = <span class="keyword">new</span> Request.Builder().url(<span class="string">"https://www.googleapis.com/books/v1/volumes?q="</span> + term).build();</span><br><span class="line">        <span class="comment">// データの取得後の命令を実装</span></span><br><span class="line">        Callback callBack = <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 失敗した時の命令</span></span><br><span class="line">                <span class="comment">// 通信に失敗した原因をログに出力</span></span><br><span class="line">                Log.e(<span class="string">"failure API Response"</span>, e.getLocalizedMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="comment">// 成功した時の命令</span></span><br><span class="line">                <span class="comment">// Google Books APIから取得したデータをログに出力</span></span><br><span class="line">                <span class="comment">// Jsonのパースが失敗してアプリの強制終了を回避する機能</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// JsonデータをJSONObjectに変換</span></span><br><span class="line">                    JSONObject rootJson = <span class="keyword">new</span> JSONObject(response.body().string());</span><br><span class="line">                    <span class="comment">// Jsonデータから蔵書リストデータ"items"を取得</span></span><br><span class="line">                    JSONArray items = rootJson.getJSONArray(<span class="string">"items"</span>);</span><br><span class="line">                    Log.d(<span class="string">"Success API Response"</span>, <span class="string">"APIから取得したデータの件数:"</span> +</span><br><span class="line">                            items.length());</span><br><span class="line">                    <span class="comment">// メインスレッドで実行する処理をインスタンス化</span></span><br><span class="line">                    ReflectResult reflectResult = <span class="keyword">new</span> ReflectResult(items);</span><br><span class="line">                    <span class="comment">// Handlerにてメインスレッドに処理を戻し、ReflectResultのrunメソッドを実行する</span></span><br><span class="line">                    handler.post(reflectResult);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">                    <span class="comment">// Jsonパースの時にエラーが発生したらログに出力する</span></span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 非同期処理でAPI通信を実行</span></span><br><span class="line">        okHttpClient.newCall(request).enqueue(callBack);</span><br><span class="line">        <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑削除↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">        <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">        <span class="comment">// FragmentContainerにResultListFragmentを表示させる処理</span></span><br><span class="line">        ResultListFragment resultListFragment = ResultListFragment.getInstance(term);</span><br><span class="line">        <span class="comment">// Activity内で表示するFragmentを管理するクラスをインスタンス化</span></span><br><span class="line">        FragmentManager fm = getSupportFragmentManager();</span><br><span class="line">        <span class="comment">// Fragmentを表示、または別のFragmentに遷移するためのクラスをインスタンス化</span></span><br><span class="line">        FragmentTransaction ft = fm.beginTransaction();</span><br><span class="line">        <span class="comment">// FragmentManagerに新しいFragmentを追加</span></span><br><span class="line">        <span class="comment">// FragmentContainerにResultListFragmentを表示するよう設定</span></span><br><span class="line">        ft.add(R.id.FragmentContainer, resultListFragment);</span><br><span class="line">        <span class="comment">// 上記の設定でFragmentManagerを更新</span></span><br><span class="line">        ft.commit();</span><br><span class="line">        <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓削除↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="comment">// ListViewの各行をクリックした時の命令を実装</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; adapterView, View view, <span class="keyword">int</span> i, <span class="keyword">long</span> l)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// クリックした行番号をToastで表示する</span></span><br><span class="line">        Toast.makeText(ResultListActivity.<span class="keyword">this</span></span><br><span class="line">                , (i + <span class="number">1</span>) + <span class="string">"行目をクリックしました"</span></span><br><span class="line">                , Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 検索結果をListViewに反映するメインスレッドの処理クラス</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectResult</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 蔵書一覧タイトルデータリスト</span></span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; titleList;</span><br><span class="line">        <span class="comment">// 蔵書一覧概要データリスト</span></span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; summaryList;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// コンストラクタ</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ReflectResult</span><span class="params">(JSONArray items)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// リストデータを初期化</span></span><br><span class="line">            titleList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            summaryList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="comment">// Jsonのパースエラーが発生した時に備えてtry~catchする</span></span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="comment">// 蔵書リストの件数分繰り返しタイトルをログ出力する</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; items.length(); i ++) &#123;</span><br><span class="line">                    <span class="comment">// 蔵書リストから i番目のデータを取得</span></span><br><span class="line">                    JSONObject item = items.getJSONObject(i);</span><br><span class="line">                    <span class="comment">// 蔵書のi番目データから蔵書情報のグループを取得</span></span><br><span class="line">                    JSONObject volumeInfo = item.getJSONObject(<span class="string">"volumeInfo"</span>);</span><br><span class="line">                    <span class="comment">// タイトルデータをリストに追加</span></span><br><span class="line">                    titleList.add(volumeInfo.getString(<span class="string">"title"</span>));</span><br><span class="line">                    <span class="comment">// 概要データをリストに追加</span></span><br><span class="line">                    summaryList.add(volumeInfo.getString(<span class="string">"description"</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Handlerから実行されるメソッド</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// ListViewに表示する情報をまとめるAdapterをインスタンス化</span></span><br><span class="line">            adapter = <span class="keyword">new</span> ResultListAdapter(ResultListActivity.<span class="keyword">this</span>, titleList, summaryList);</span><br><span class="line">            <span class="comment">// ListViewに表示情報をまとめたAdapterをセット</span></span><br><span class="line">            resultListView.setAdapter(adapter);</span><br><span class="line">            <span class="comment">// ListViewに行をクリックした時のイベントを登録</span></span><br><span class="line">            resultListView.setOnItemClickListener(ResultListActivity.<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑削除↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上記のコード修正が終わったら動作確認します。<br>正常に検索結果画面に遷移できるか確認してみましょう。</p>
<p>今回Fragmentの実装では２つのライフサイクルメソッドを利用しました、<a href="/AndroidCourse/android/02-AndroidConcept">Androidの概念</a>で一度ライフサイクルの図をご紹介しましたが、<br>Fragmentの<code>onCreateView()</code>、<code>onActivityCreated()</code>はActivityの<code>onCreate()</code>メソッドの後に実行されます。</p>
<p>Fragmentで画面の要素を取得するためには<code>getView()</code>メソッドを利用します。<br><code>getView()</code>メソッドはFragment内のどのライフサイクルでも参照できますが、<code>onAttach()</code>〜<code>onCtreateView()</code>のライフサイクルメソッドでは、ActivityにFragmentのレイアウトが反映されていないため”null”が返却されるので注意が必要です。</p>
<p>またFragmentは引数のないコンストラクタを必ず用意しないといけません。<br>Android端末ではメモリが不足した場合にActivityやFragmentを一旦破棄し必要になったタイミングで再度生成される仕組みになっており、この時にFragmentは引数のないコンストラクタを実行しインスタンス化を行っています。<br>メモリからFragmentが破棄されても<code>Bundle</code>は破棄されずに残るため、<code>fragment.setArguments(Bundle)</code>を使いFragmentでデータ渡しを行う必要があります。<br>Fragmentのインスタンス化時に引数ありのコンストラクタを使用していた場合、万が一メモリ不足からFragmentが再生成された時にアプリが強制終了する可能性が考えられます。<br>画面が回転した時など画面サイズに変更が加わった場合などを考慮する場合は注意して実装する必要がある。</p>
<h2><span id="定数">定数</span></h2><p>文字通り宣言時にセットした値を変更することができない要素。<br>上記で実装した通り<strong>final</strong>のキーワードを変数宣言時に記述することで定数としての扱いになります。<br>また<strong>static</strong>のキーワードをつけることでクラスがインスタンス化されていなくても参照することができるようになります。<br>java,Androidでは定数と変数を見分けやすくするために全て大文字で定数名を宣言することが多いです。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String BUNDLE_KEY = <span class="string">"BUNDLE_TERM"</span>;</span><br></pre></td></tr></table></figure></p>
<h2><span id="context概要">Context概要</span></h2><p>Androidアプリ開発の中ではxmlレイアウトをjavaファイルで参照する時などには必ず必要になる”Context”は一体何か。<br>Activity,Service,Applicationの親クラスであり、アプリケーショングローバル情報へアクセスするためのインターフェースの役割を持つクラス。<br>アプリケーションのグローバル情報とは</p>
<ul>
<li>パーミッション(インターネット接続などの許可設定)</li>
<li>アプリリソースへのアクセス(画像やレイアウトなど”res”ディレクトリ配下の要素を参照するための機能)</li>
<li>アプリ情報(コンポーネント、プロセス名、テーマなど)</li>
</ul>
<p>などが該当します。<br>Contextを利用することで上記の情報を参照することが可能になります。</p>
<p>Contextの取得方法には<code>getActivity()[Activity内ではthis]</code>,<code>getApplicationContext()</code>などいくつか方法がありますが、各Contextは利用可能な寿命が違っており、Activityを対象にしたContext(<code>getActivity()</code>で取得したContext)の場合はActivityが破棄されると同時にContextも破棄されます。<br>対して<code>getApplicationContext()</code>ではApplicationクラスに依存するため、アプリを破棄するまで使用できます。<br>現状では影響のあるプログラムはありませんが、ActivityとApplicationに設定されているテーマ(Theme)がそれぞれ違う場合に期待しない表示になるなどの不具合が発生する可能性が考えられます。</p>
<p>あまり使われないメソッドですが<code>getBaseContext()</code>というメソッドも存在しますが、深い話しで使用は推奨されていないようです。。。</p>
<p>Contextはレイアウトなどの”res”ディレクトリ内を参照したりレイアウトをjavaファイルで使うための便利かつ必要なものと認識して利用すれば問題ありません。<br>実際にアプリ開発で内部情報に影響されることはないと思われます。</p>
<h1><span id="蔵書詳細画面作成">蔵書詳細画面作成</span></h1><p>ActivityからFragmentへの移行が完了したら蔵書詳細画面を作成していきます。<br><img src="/AndroidCourse/android/09-RefactorFragment/detailExample.png" width="250" title="Detail Example"></p>
<p>検索結果画面の時と同様にメニューもしくはプロジェクトツリーが表示されているウィンドウで右クリック(macでは２本指でクリック)から以下の項目を選択します。</p>
<blockquote>
<p>New -&gt; Fragment -&gt; Fragment(Blank)</p>
</blockquote>
<p>作成するFragment名や同時に作成されるレイアウトファイル名を入力し、以下の項目の設定を修正したら<code>Finish</code>をクリックします。<br><img src="/AndroidCourse/android/09-RefactorFragment/addDetail01.png" width="600" title="Add Detail Screen"> </p>
<table>
<thead>
<tr>
<th>項目</th>
<th>設定値</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fragment Name</td>
<td>DetailFragment</td>
</tr>
<tr>
<td>Create Layout XML?</td>
<td>チェックを<font color="blue">つける</font></td>
</tr>
<tr>
<td>Fragment Layout Name</td>
<td>fragment_detail</td>
</tr>
<tr>
<td>Include fragment factory methods?</td>
<td>チェックを<font color="red">つけない</font></td>
</tr>
<tr>
<td>Include interface callbacks?</td>
<td>チェックを<font color="red">つけない</font></td>
</tr>
</tbody>
</table>
<p><code>DetailFragment.java</code>と<code>fragment_detail.xml</code>ファイルが生成されます。<br>まずは蔵書詳細画面のレイアウトを修正していきます。<br><code>fragment_detail.xml</code>を開き、<em>Design</em>タブが表示されている場合は<em>Text</em>タブをクリックしてxmlファイルの実装画面に切り替えます。<br><img src="/AndroidCourse/android/09-RefactorFragment/addDetail02.png" width="600" title="Add Detail Screen"><br><figure class="highlight xml"><figcaption><span>fragment_detail.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ↓↓↓↓↓↓↓↓↓↓削除↓↓↓↓↓↓↓↓↓↓ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">"kuririnz.xyz.bookdiscovery.DetailFragment"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- <span class="doctag">TODO:</span> Update blank fragment layout --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/hello_blank_fragment"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ↑↑↑↑↑↑↑↑↑↑削除↑↑↑↑↑↑↑↑↑↑ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_margin</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">"kuririnz.xyz.bookdiscovery.DetailFragment"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/DetailTitle"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">"20dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:text</span>=<span class="string">"蔵書タイトル"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:weightSum</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/DetailImage"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingLeft</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:scaleType</span>=<span class="string">"fitCenter"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:adjustViewBounds</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/DetailSubTitle"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">tools:text</span>=<span class="string">"蔵書サブタイトル"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/DetailAuthor"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginTop</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">tools:text</span>=<span class="string">"蔵書作者名"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/DetailDescription"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:lines</span>=<span class="string">"10"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:text</span>=<span class="string">"蔵書概要を表示"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"8dp"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/DetailPageHeader"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignParentLeft</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"ページ数："</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/DetailPageText"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_toRightOf</span>=<span class="string">"@id/DetailPageHeader"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">tools:text</span>=<span class="string">"53ページ"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/DetailPublishDateHeader"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_toLeftOf</span>=<span class="string">"@id/DetailPublishDateText"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"発売日："</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/DetailPublishDateText"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignParentRight</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">tools:text</span>=<span class="string">"2018/02/06"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑ --&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>これで蔵書詳細画面のレイアウトは完了です。</p>
<p>“LinearLayout”や”RelativeLayout”を使用して画面レイアウトを作成するとこのようにLayoutの中にLayoutやTextViewなどのコンポーネントを配置するネスト構造での実装が必要になります。<br>“ConstraintLayout”ではネスト構造にならずにレイアウトを作成することが可能です。</p>
<p>今回出てきた属性について簡単に解説していきます。</p>
<table>
<thead>
<tr>
<th>対象のView</th>
<th>属性</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>LinearLayout</td>
<td>android:weightSum</td>
<td>縦または横方向に対して設定された数値分に均等分割する。縦横方向はorientation属性から判定される</td>
</tr>
<tr>
<td>weightSum属性をセットしたLinearLayoutの子View</td>
<td>android:layout_weight</td>
<td>親のLinearLayoutで設定されたweightSumのうち占有する割合値を設定する、有効にする場合には”layout_width”または”layout_height”を0dpにする必要がある。android:layout_alignParentLeft</td>
</tr>
<tr>
<td>RelativeLayoutの子View</td>
<td>android:layout_alignParentLeft</td>
<td>親のRelativeLayoutの左端に自Viewの左端を合わせて配置する</td>
</tr>
<tr>
<td>RelativeLayoutの子View</td>
<td>android:layout_alignParentRight</td>
<td>親のRelativeLayoutの右端に自Viewの右端を合わせて配置する</td>
</tr>
<tr>
<td>RelativeLayoutの子View</td>
<td>android:layout_toRightOf</td>
<td>設定したidを持つViewの右側に自Viewを配置する</td>
</tr>
<tr>
<td>RelativeLayoutの子View</td>
<td>android:layout_toLeftOf</td>
<td>設定したidを持つViewの左側に自Viewを配置する</td>
</tr>
</tbody>
</table>
<h1><span id="蔵書詳細画面遷移実装">蔵書詳細画面遷移実装</span></h1><p>蔵書検索結果一覧画面から行アイテムをクリックしたら蔵書詳細画面に遷移するように実装を修正します。<br><figure class="highlight java"><figcaption><span>ResultListFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">...一部省略</span><br><span class="line"></span><br><span class="line"><span class="comment">// ListViewの各行をクリックした時の命令を実装</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; adapterView, View view, <span class="keyword">int</span> i, <span class="keyword">long</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// クリックした行番号をToastで表示する</span></span><br><span class="line">    Toast.makeText(getContext()</span><br><span class="line">            , (i + <span class="number">1</span>) + <span class="string">"行目をクリックしました"</span></span><br><span class="line">            , Toast.LENGTH_SHORT).show();</span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="comment">// 蔵書詳細画面用Fragmentをインスタンス化</span></span><br><span class="line">    DetailFragment detailFragment = <span class="keyword">new</span> DetailFragment();</span><br><span class="line">    <span class="comment">// support.v4.app.Fragment内ではgetFragmentManager = Activity.getSupportFragmentManager</span></span><br><span class="line">    FragmentManager fm = getFragmentManager();</span><br><span class="line">    <span class="comment">// 別のFragmentに遷移するためのクラスをインスタンス化</span></span><br><span class="line">    FragmentTransaction ft = fm.beginTransaction();</span><br><span class="line">    <span class="comment">// Fragmentを表示させるViewのidとFragmentクラスを設定</span></span><br><span class="line">    ft.replace(R.id.FragmentContainer, detailFragment);</span><br><span class="line">    <span class="comment">// 表示していたFragmentをバックスタックに追加</span></span><br><span class="line">    ft.addToBackStack(<span class="keyword">null</span>);</span><br><span class="line">    <span class="comment">// FragmentManagerに反映</span></span><br><span class="line">    ft.commit();</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">&#125;</span><br><span class="line">...一部省略</span><br></pre></td></tr></table></figure></p>
<p>上記コードを実装したら動作確認します。</p>
<p>これで自動的に表示していたFragmentがスタック（破棄せず残っているデータ）され、スタックされたFragmentが残っている場合はActivityではなく、Fragmentが一つ戻るように実装されました。<br>Fragmentには”ID”や”TAG”という情報を設定することができ、一つ前のFragmentではなくスタックされいているFragmentから”ID”や”TAG”を指定して画面バックを行うことも可能です。</p>
<h1><span id="蔵書詳細画面実装">蔵書詳細画面実装</span></h1><p>蔵書の詳細情報として著作者や概要などを表示していきます。<br>蔵書を一つを特定するために今回は検索結果一覧画面でREST APIから取得したデータに含まれる”selfLink”キーに含まれるurl情報を蔵書詳細画面で改めてREST APIを使用して取得する形で実装していきます。<br>蔵書詳細画面で取得したデータのパースに関してはJSONデータをモデルクラスに一発変換してくれるライブラリを使ってJSONObjectでの実装の手間を軽くする方法を使います。<br>また、検索結果一覧画面で表示するデータも増えてきたため、まとめてデータを持てるようにモデルクラスを作成して管理します。</p>
<p>まずは、JSON文字列の簡単パースライブラリ<strong>Gson</strong>を導入します。<br>プロジェクトからapp階層の<code>build.gradle</code>を開き、”dependencies” の “{}”内に以下のコードを記述します<br>開くのは<code>build.gradle</code>の後ろに<strong><em>(Module: app)</em></strong>と表示されている方です。<br><img src="/AndroidCourse/android/07-AsyncProcess/includeokHttp01.png" width="550" title="IncludeokHttp"><br><figure class="highlight gradle"><figcaption><span>build.gradle(Module: app)</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    ...一部省略</span><br><span class="line">    implementation <span class="string">'com.squareup.okhttp3:okhttp:3.9.1'</span></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    implementation <span class="string">'com.google.code.gson:gson:2.2.4'</span></span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上記コードを追加後、<font color="blue"><strong>Sync Now</strong></font>をクリックしてGSONの導入は完了です。<br><img src="/AndroidCourse/android/09-RefactorFragment/addDetail06.png" width="550" title="Include GSON"><br>次に新しくモデルクラスを作成します。</p>
<blockquote>
<p>プロジェクトウィンドウ右クリック &gt; New &gt; Java Class</p>
</blockquote>
<p>モデルクラスは２つ作成します。<br>一つは検索結果一覧でデータを表示するためのモデルクラス、もう一つは蔵書詳細画面のREST APIをパースするためのモデルクラスです。<br>まずは検索結果一覧に一覧表示しているデータをモデルクラスとしてまとめます。</p>
<p>クラス名とパッケージを確認したら<code>OK</code>をクリック<br><img src="/AndroidCourse/android/09-RefactorFragment/addDetail07.png" width="550" title="Include GSON"><br>こちらは検索結果一覧画面で利用するモデルクラスとして変数を宣言していきます。<br><figure class="highlight java"><figcaption><span>ResultListMdel.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultListModel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="comment">// 蔵書タイトル</span></span><br><span class="line">    <span class="keyword">public</span> String title;</span><br><span class="line">    <span class="comment">// 蔵書概要</span></span><br><span class="line">    <span class="keyword">public</span> String summary;</span><br><span class="line">    <span class="comment">// 蔵書単体リンク</span></span><br><span class="line">    <span class="keyword">public</span> String selfLink;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>クラス名とパッケージを確認したら<code>OK</code>をクリック<br><img src="/AndroidCourse/android/09-RefactorFragment/addDetail08.png" width="550" title="Include GSON"><br>２つ目のクラスは蔵書詳細画面のREST APIデータをパースして使用するためのモデルクラスです。<br><figure class="highlight java"><figcaption><span>DetailDataModal.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DetailDataModel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="comment">// 蔵書単体リンク</span></span><br><span class="line">    <span class="keyword">public</span> String selfLink;</span><br><span class="line">    <span class="comment">// 蔵書概要データ</span></span><br><span class="line">    <span class="keyword">public</span> VolumeInfo volumeInfo;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 蔵書概要クラス</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VolumeInfo</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 蔵書タイトル</span></span><br><span class="line">        <span class="keyword">public</span> String title;</span><br><span class="line">        <span class="comment">// 蔵書サブタイトル</span></span><br><span class="line">        <span class="keyword">public</span> String subTitle;</span><br><span class="line">        <span class="comment">// 蔵書著者リスト</span></span><br><span class="line">        <span class="keyword">public</span> List&lt;String&gt; authors;</span><br><span class="line">        <span class="comment">// 蔵書発売日</span></span><br><span class="line">        <span class="keyword">public</span> String publishedDate;</span><br><span class="line">        <span class="comment">// 蔵書概要</span></span><br><span class="line">        <span class="keyword">public</span> String description;</span><br><span class="line">        <span class="comment">// 蔵書ページ数</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> pageCount;</span><br><span class="line">        <span class="comment">// 蔵書サムネイル画像URL</span></span><br><span class="line">        <span class="keyword">public</span> ImageLinks imageLinks;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 蔵書サムネイルクラス</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageLinks</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 蔵書小サイズサムネイル</span></span><br><span class="line">        <span class="keyword">public</span> String smallThumbnail;</span><br><span class="line">        <span class="comment">// 蔵書サムネイル</span></span><br><span class="line">        <span class="keyword">public</span> String thumbnail;</span><br><span class="line">        <span class="comment">// 中サイズ表示画像</span></span><br><span class="line">        <span class="keyword">public</span> String medium;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>DetailFragment.java</code>のプログラムを修正する前に”import”設定を修正します。<br><code>ResultListFragment.java</code>と同様に<code>import..</code>の一覧から<br><em>import android.app.Fragment;</em>を削除します。<br><img src="/AndroidCourse/android/09-RefactorFragment/addDetail03.png" width="600" title="Import Change"><br>次に<font color="red">赤くなった<code>Fragmet</code></font>をクリックし上に表示されるツールチップに従い<br><kbd>Alt</kbd><kbd>+</kbd><kbd>Enter</kbd>(Macは<kbd>option</kbd><kbd>+</kbd><kbd>Enter</kbd>)を入力<br><img src="/AndroidCourse/android/09-RefactorFragment/addDetail04.png" width="600" title="Import Change"><br>ウィンドウに選択肢が表示されたら<strong>Fragment (android.support.v4.app)</strong>を選択します。<br><img src="/AndroidCourse/android/09-RefactorFragment/addDetail05.png" width="600" title="Import Change"><br><code>DetailFragment.java</code>では取得したAPIデータをパースし、一旦タイトルをログに出力させてみます。<br><figure class="highlight java"><figcaption><span>DetailFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DetailFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="comment">// データ渡しのキー情報</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String BUNDLE_KEY = <span class="string">"BUNDLE_SELFLINK"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// xmlファイルのコンポーネントと関連付ける要素</span></span><br><span class="line">    <span class="keyword">private</span> TextView titleText;</span><br><span class="line">    <span class="keyword">private</span> TextView subTitleText;</span><br><span class="line">    <span class="keyword">private</span> TextView authorText;</span><br><span class="line">    <span class="keyword">private</span> TextView descriptText;</span><br><span class="line">    <span class="keyword">private</span> TextView pageText;</span><br><span class="line">    <span class="keyword">private</span> TextView publishDateText;</span><br><span class="line">    <span class="comment">// APIの検索に使うISBNコード</span></span><br><span class="line">    <span class="keyword">private</span> String isbn;</span><br><span class="line">    <span class="comment">// 個体リンクのURL</span></span><br><span class="line">    <span class="keyword">private</span> String selfLink;</span><br><span class="line">    <span class="comment">// APIのデータ取得後処理を行うためのHandler</span></span><br><span class="line">    <span class="keyword">private</span> Handler handler;</span><br><span class="line">    <span class="comment">// OkHttp通信クライアント</span></span><br><span class="line">    <span class="keyword">private</span> OkHttpClient okHttpClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// スタティックコンストラクタ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DetailFragment <span class="title">getInstance</span><span class="params">(String selfLink)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// DetailFragmentインスタンスを生成</span></span><br><span class="line">        DetailFragment fragment = <span class="keyword">new</span> DetailFragment();</span><br><span class="line">        <span class="comment">// DetailFragmentに渡すデータ格納クラスを生成</span></span><br><span class="line">        Bundle args = <span class="keyword">new</span> Bundle();</span><br><span class="line">        <span class="comment">// 検索文字列データを連携データにセット</span></span><br><span class="line">        args.putString(BUNDLE_KEY, selfLink);</span><br><span class="line">        <span class="comment">// データ格納クラスをDetailFragmentインスタンスにセット</span></span><br><span class="line">        fragment.setArguments(args);</span><br><span class="line">        <span class="comment">// 生成したResultListFragmentを返却</span></span><br><span class="line">        <span class="keyword">return</span> fragment;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DetailFragment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Required empty public constructor</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container,</span></span></span><br><span class="line"><span class="function"><span class="params">                             Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Inflate the layout for this fragment</span></span><br><span class="line">        <span class="keyword">return</span> inflater.inflate(R.layout.fragment_detail, container, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityCreated</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onActivityCreated(savedInstanceState);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Handlerをインスタンス化</span></span><br><span class="line">        handler = <span class="keyword">new</span> Handler();</span><br><span class="line">        <span class="comment">// 連携データが存在するか確認</span></span><br><span class="line">        <span class="keyword">if</span> (getArguments() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 連携データ内から"BUNDLE_SELFLINK"キーのデータを代入、なければ"Android"と文字列を代入</span></span><br><span class="line">            selfLink = getArguments().getString(BUNDLE_KEY, <span class="string">""</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// selfLinkが空の場合は検索結果一覧画面に強制バック</span></span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(selfLink)) &#123;</span><br><span class="line">            getFragmentManager().popBackStack();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// xmlファイルのコンポーネントと関連付け</span></span><br><span class="line">        titleText = getView().findViewById(R.id.DetailTitle);</span><br><span class="line">        subTitleText = getView().findViewById(R.id.DetailSubTitle);</span><br><span class="line">        authorText = getView().findViewById(R.id.DetailAuthor);</span><br><span class="line">        descriptText = getView().findViewById(R.id.DetailDescription);</span><br><span class="line">        pageText = getView().findViewById(R.id.DetailPageText);</span><br><span class="line">        publishDateText = getView().findViewById(R.id.DetailPublishDateText);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// OkHttp通信クライアントをインスタンス化</span></span><br><span class="line">        okHttpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line">        <span class="comment">// 通信するための情報</span></span><br><span class="line">        <span class="comment">// ResultListFragmentから取得したselfLinkURLにREST API通信を行う</span></span><br><span class="line">        Request request = <span class="keyword">new</span> Request.Builder().url(selfLink).build();</span><br><span class="line">        <span class="comment">// データの取得後の命令を実装</span></span><br><span class="line">        Callback callBack = <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 通信に失敗した原因をログに出力</span></span><br><span class="line">                Log.e(<span class="string">"failure API Response"</span>, e.getLocalizedMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="comment">// JsonパースライブラリGsonのインスタンス化</span></span><br><span class="line">                Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">                <span class="comment">// 返却されたJson文字列を一旦変数に代入</span></span><br><span class="line">                String jsonString = response.body().string();</span><br><span class="line">                <span class="comment">// DetailDataModelクラスに代入</span></span><br><span class="line">                DetailDataModel detailData = gson.fromJson(jsonString, DetailDataModel.class);</span><br><span class="line">                <span class="comment">// パースが正常に行えたかLogcatに出力して確認。</span></span><br><span class="line">                Log.d(<span class="string">"DetailFragment parse"</span>, detailData.volumeInfo.title);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 非同期処理でREST API通信を実行</span></span><br><span class="line">        okHttpClient.newCall(request).enqueue(callBack);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><figcaption><span>ResultListAdapter.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultListAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ListViewの描画に必要な変数を宣言</span></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓削除↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; titleList;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; summaryList;</span><br><span class="line">    <span class="keyword">private</span> LayoutInflater layoutInflater;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// コンストラクタ(インスタンス時に呼び出されるメソッドのようなもの)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ResultListAdapter</span><span class="params">(Context context, List&lt;String&gt; titleList, List&lt;String&gt; summaryList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.titleList = titleList;</span><br><span class="line">        <span class="keyword">this</span>.summaryList = summaryList;</span><br><span class="line">        <span class="keyword">this</span>.layoutInflater = LayoutInflater.from(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 一覧表示する要素数を返却する</span></span><br><span class="line">        <span class="keyword">return</span> titleList.size();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑削除↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ResultListModel&gt; resultList;</span><br><span class="line">    <span class="keyword">private</span> LayoutInflater layoutInflater;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// コンストラクタ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ResultListAdapter</span><span class="params">(Context context, List&lt;ResultListModel&gt; resultList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.resultList = resultList;</span><br><span class="line">        <span class="keyword">this</span>.layoutInflater = LayoutInflater.from(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 一覧表示する要素数を返却する</span></span><br><span class="line">        <span class="keyword">return</span> resultList.size();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line"></span><br><span class="line">    ...一部省略</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> i, View view, ViewGroup viewGroup)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 各行の表示レイアウト読み込みや、描画情報の設定を実装する</span></span><br><span class="line">        <span class="comment">// getViewで返却されたViewがListViewに表示される</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// viewの中身が空かチェック</span></span><br><span class="line">        <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// viewがレイアウトを読み込んでいない場合は"row_result_list"を読み込む</span></span><br><span class="line">            view = layoutInflater.inflate(R.layout.row_result_list, viewGroup, <span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// row_result_listのTitleとSummaryに文言を代入</span></span><br><span class="line">        TextView titleView = view.findViewById(R.id.RowListTitle);</span><br><span class="line">        TextView summaryView = view.findViewById(R.id.RowListSummary);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓削除↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">        titleView.setText(titleList.get(i));</span><br><span class="line">        summaryView.setText(summaryList.get(i));</span><br><span class="line">        <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑削除↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">        <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">        titleView.setText(resultList.get(i).title);</span><br><span class="line">        summaryView.setText(resultList.get(i).summary);</span><br><span class="line">        <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 文字情報を代入されたviewを返却</span></span><br><span class="line">        <span class="keyword">return</span> view;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><figcaption><span>ResultListFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultListFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> <span class="keyword">implements</span> <span class="title">AdapterView</span>.<span class="title">OnItemClickListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="comment">// 検索結果一覧データ</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ResultListModel&gt; resultList;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line"></span><br><span class="line">    ...一部省略</span><br><span class="line">    <span class="comment">// ListViewの各行をクリックした時の命令を実装</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; adapterView, View view, <span class="keyword">int</span> i, <span class="keyword">long</span> l)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// クリックした行番号をToastで表示する</span></span><br><span class="line">        Toast.makeText(getContext()</span><br><span class="line">                , (i + <span class="number">1</span>) + <span class="string">"行目をクリックしました"</span></span><br><span class="line">                , Toast.LENGTH_SHORT).show();</span><br><span class="line">        <span class="comment">// 蔵書詳細画面用Fragmentをインスタンス化</span></span><br><span class="line">        <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓削除↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">        DetailFragment detailFragment = <span class="keyword">new</span> DetailFragment();</span><br><span class="line">        <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑削除↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">        <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">        DetailFragment detailFragment = DetailFragment.getInstance(resultList.get(i).selfLink);</span><br><span class="line">        <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">        <span class="comment">// support.v4.app.Fragment内ではgetFragmentManager = Activity.getSupportFragmentManager</span></span><br><span class="line">        FragmentManager fm = getFragmentManager();</span><br><span class="line">        <span class="comment">// 別のFragmentに遷移するためのクラスをインスタンス化</span></span><br><span class="line">        FragmentTransaction ft = fm.beginTransaction();</span><br><span class="line">        <span class="comment">// Fragmentを表示させるViewのidとFragmentクラスを設定</span></span><br><span class="line">        ft.replace(R.id.FragmentContainer, detailFragment);</span><br><span class="line">        <span class="comment">// 表示していたFragmentをバックスタックに追加</span></span><br><span class="line">        ft.addToBackStack(<span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// FragmentManagerに反映</span></span><br><span class="line">        ft.commit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 検索結果をListViewに反映するメインスレッドの処理クラス</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectResult</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓削除↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">        <span class="comment">// 蔵書一覧タイトルデータリスト</span></span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; titleList;</span><br><span class="line">        <span class="comment">// 蔵書一覧概要データリスト</span></span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; summaryList;</span><br><span class="line">        <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑削除↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// コンストラクタ</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ReflectResult</span><span class="params">(JSONArray items)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓削除↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">            titleList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            summaryList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑削除↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">            <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">            <span class="comment">// 蔵書モデルクラスリスト</span></span><br><span class="line">            resultList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">            <span class="comment">// Jsonのパースエラーが発生した時に備えてtry~catchする</span></span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="comment">// 蔵書リストの件数分繰り返しタイトルをログ出力する</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; items.length(); i ++) &#123;</span><br><span class="line">                    <span class="comment">// 蔵書リストから i番目のデータを取得</span></span><br><span class="line">                    JSONObject item = items.getJSONObject(i);</span><br><span class="line">                    <span class="comment">// 蔵書のi番目データから蔵書情報のグループを取得</span></span><br><span class="line">                    JSONObject volumeInfo = item.getJSONObject(<span class="string">"volumeInfo"</span>);</span><br><span class="line">                    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓削除↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">                    <span class="comment">// タイトルデータをリストに追加</span></span><br><span class="line">                    titleList.add(volumeInfo.getString(<span class="string">"title"</span>));</span><br><span class="line">                    <span class="comment">// 概要データをリストに追加</span></span><br><span class="line">                    summaryList.add(volumeInfo.getString(<span class="string">"description"</span>));</span><br><span class="line">                    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑削除↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">                    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">                    <span class="comment">// 蔵書データクラスをインスタンス化</span></span><br><span class="line">                    ResultListModel resultData = <span class="keyword">new</span> ResultListModel();</span><br><span class="line">                    <span class="comment">// タイトルをモデルクラスに代入</span></span><br><span class="line">                    resultData.title = volumeInfo.getString(<span class="string">"title"</span>);</span><br><span class="line">                    <span class="comment">// 個体蔵書データURLをモデルクラスに代入</span></span><br><span class="line">                    resultData.selfLink = item.getString(<span class="string">"selfLink"</span>);</span><br><span class="line">                    <span class="comment">// データに"description"キーが含まれている場合は情報を代入</span></span><br><span class="line">                    <span class="keyword">if</span> (volumeInfo.has(<span class="string">"description"</span>)) &#123;</span><br><span class="line">                        <span class="comment">// 概要をモデルクラスに代入</span></span><br><span class="line">                        resultData.summary = volumeInfo.getString(<span class="string">"description"</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// "description"キーが含まれていない場合は空文字データを代入</span></span><br><span class="line">                        resultData.summary = <span class="string">""</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 蔵書情報をリストに登録</span></span><br><span class="line">                    resultList.add(resultData);</span><br><span class="line">                    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Handlerから実行されるメソッド</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// ListViewに表示する情報をまとめるAdapterをインスタンス化</span></span><br><span class="line">            <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓削除↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">            adapter = <span class="keyword">new</span> ResultListAdapter(getContext(), titleList, summaryList);</span><br><span class="line">            <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑削除↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">            <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">            adapter = <span class="keyword">new</span> ResultListAdapter(getContext(), resultList);</span><br><span class="line">            <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">            <span class="comment">// ListViewに表示情報をまとめたAdapterをセット</span></span><br><span class="line">            resultListView.setAdapter(adapter);</span><br><span class="line">            <span class="comment">// ListViewに行をクリックした時のイベントを登録</span></span><br><span class="line">            resultListView.setOnItemClickListener(ResultListFragment.<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上記コード修正が終わったら動作確認してみます。<br>正常に処理が実行されれば蔵書詳細画面に遷移し、<strong>Logcat</strong>に検索結果一覧で選択した蔵書のタイトルが表示されると思います。</p>
<p>AndroidアプリではREST API通信を行い取得したデータをGsonというライブラリを利用することで簡単にパースすることができます。<br>ただGsonでパースするときには取得データと同じ階層構造を指定したクラスを作成して上げる必要があるので期待通りパースされない場合、まずJSONデータと作成したクラスの階層構造をお確認すると良いでしょう。<br>また取得するデータキーとクラスの変数名を合わせて実装する必要があるので入力ミスにも注意が必要です。</p>
<p>今回の実装で便利なUtilクラスを使いましたので紹介です、<code>DetailFragment.java</code>において”selfLink”変数にデータが格納されているか判定するために<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TextUtils.isEmpty(selfLink)</span><br></pre></td></tr></table></figure></p>
<p>という実装をしています、<code>TextUtils</code>はString型変数の処理で便利な機能が揃っており上記のメソッドでは、引数の内容が”null”や空文字列かを判定し”true”を返却してくれます。<br>多く使うメソッドはこの<code>TextUtils.isEmpty()</code>が多くなると思いますが、判定処理を完結しにてくれるのでとても有効です。</p>
<p>続いて蔵書詳細データを画面のTextViewにセットしていきます。<br><figure class="highlight java"><figcaption><span>DetailFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DetailFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line">    ...一部省略</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityCreated</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">	    ...一部省略</span><br><span class="line"></span><br><span class="line">        <span class="comment">// データの取得後の命令を実装</span></span><br><span class="line">        Callback callBack = <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 通信に失敗した原因をログに出力</span></span><br><span class="line">                Log.e(<span class="string">"failure API Response"</span>, e.getLocalizedMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="comment">// JsonパースライブラリGsonのインスタンス化</span></span><br><span class="line">                Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">                <span class="comment">// 返却されたJson文字列を一旦変数に代入</span></span><br><span class="line">                String jsonString = response.body().string();</span><br><span class="line">                <span class="comment">// DetailDataModelクラスに代入</span></span><br><span class="line">                DetailDataModel detailData = gson.fromJson(jsonString, DetailDataModel.class);</span><br><span class="line">                <span class="comment">// パースが正常に行えたかLogcatに出力して確認。</span></span><br><span class="line">                Log.d(<span class="string">"DetailFragment parse"</span>, detailData.volumeInfo.title);</span><br><span class="line">                <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">                <span class="comment">// MainThreadに処理を渡し画面にデータを反映する</span></span><br><span class="line">                handler.post(<span class="keyword">new</span> ReflectDetail(detailData));</span><br><span class="line">                <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 非同期処理でREST API通信を実行</span></span><br><span class="line">        okHttpClient.newCall(request).enqueue(callBack);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="comment">// REST APIで取得したデータを画面に反映するためのクラス</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectDetail</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 蔵書詳細データ</span></span><br><span class="line">        DetailDataModel detailData;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// コンストラクタ</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ReflectDetail</span><span class="params">(DetailDataModel detailData)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.detailData = detailData;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Handlerから実行されるメソッド</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// タイトルを反映</span></span><br><span class="line">            titleText.setText(detailData.volumeInfo.title);</span><br><span class="line">            <span class="comment">// サブタイトルが取得できていたら反映</span></span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(detailData.volumeInfo.subTitle)) &#123;</span><br><span class="line">                subTitleText.setText(detailData.volumeInfo.subTitle);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 概要が取得できていたら反映</span></span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(detailData.volumeInfo.description)) &#123;</span><br><span class="line">                descriptText.setText(detailData.volumeInfo.description);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 著作者名が取得できていたら反映</span></span><br><span class="line">            <span class="keyword">if</span> (detailData.volumeInfo.authors != <span class="keyword">null</span> &amp;&amp; detailData.volumeInfo.authors.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                String authorString = <span class="keyword">new</span> String();</span><br><span class="line">                <span class="comment">// 著作者名が複数設定されていう場合があるので繰り返し処理で全て表示する</span></span><br><span class="line">                <span class="keyword">for</span> (String author : detailData.volumeInfo.authors) &#123;</span><br><span class="line">                    authorString += author + <span class="string">","</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                authorText.setText(authorString);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ページ数を反映</span></span><br><span class="line">            pageText.setText(String.valueOf(detailData.volumeInfo.pageCount));</span><br><span class="line">            <span class="comment">// 発売日が取得できていたら反映</span></span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(detailData.volumeInfo.publishedDate)) &#123;</span><br><span class="line">                publishDateText.setText(detailData.volumeInfo.publishedDate);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上記コードを実装したら動作確認します。<br>蔵書詳細画面に遷移してREST APIのデータを取得できるまでに少し間が空きますが、正常に実装されるとTextViewに文言が反映されます。</p>
<p>上記の実装では必要なタイミングで<strong>論理演算子(&amp;&amp;)</strong>が使われました、そしてポイントは著作者名リストの<strong>for</strong>文の使い方です。</p>
<h2><span id="for-each">for-each</span></h2><p>繰り返し処理を実装する方法として”for文”を学習しました、今回の<strong>for-each</strong>文ではコレクション型の変数に登録されている要素の回数分、繰り返し処理を実行する時の実装方法です。<br>コレクション型以外にもMap型(講座の中ではまだ未使用)や配列型の変数でも同様の実装が可能です。<br><strong>for-each</strong>文の実装テンプレート<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (配列要素の型 一時変数 : リスト型の変数) &#123;</span><br><span class="line">	<span class="comment">// 繰り返し処理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>一時変数にはリスト型変数の要素が0番目〜最後の要素まで代入された状態で繰り返し処理で参照することが可能です。<br>実際には<strong>for-each</strong>文の方が利用頻度は多いと思われます。</p>
<h2><span id="url画像読み込み処理の実装">URL画像読み込み処理の実装</span></h2><p>このページではActivity → Fragmentの移行に始まり、新規のクラスを作る回数も多かったので非常にコーディングに時間がかかったと思います。<br>それも今回の実装で終わりです！</p>
<p>Web上にアップロードされた画像をアプリで読み込みむためにも便利なライブラリがあります。<br>本来はBitmapという形式で画像インスタンスを生成し使用しなくなるときにはちゃんとAndroid OSの処理の阻害にならないよう解放する必要があるのですが、<br><strong>Glide</strong>というライブラリを使用することでそういったメモリ管理などの忘れがちな処理を補ってくれます。</p>
<p>では他のライブラリと同様に<code>build.gradle</code>に依存関係を追加します。<br>プロジェクトからappディレクトリの<code>build.gradle</code>を開き、”dependencies” の “{}”内に以下のコードを記述します<br>開くのは<code>build.gradle</code>の後ろに<strong><em>(Module: app)</em></strong>と表示されている方です。<br><figure class="highlight gradle"><figcaption><span>build.gradle(Module: app)</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">27</span></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">"kuririnz.xyz.bookdiscovery"</span></span><br><span class="line">        minSdkVersion <span class="number">23</span></span><br><span class="line">        targetSdkVersion <span class="number">27</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">"1.0"</span></span><br><span class="line">        testInstrumentationRunner <span class="string">"android.support.test.runner.AndroidJUnitRunner"</span></span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled <span class="keyword">false</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    implementation <span class="keyword">fileTree</span>(dir: <span class="string">'libs'</span>, <span class="keyword">include</span>: [<span class="string">'*.jar'</span>])</span><br><span class="line">    implementation <span class="string">'com.android.support:appcompat-v7:27.0.2'</span></span><br><span class="line">    implementation <span class="string">'com.android.support.constraint:constraint-layout:1.0.2'</span></span><br><span class="line">    implementation <span class="string">'com.android.support:design:27.0.2'</span></span><br><span class="line">    implementation <span class="string">'com.squareup.okhttp3:okhttp:3.9.1'</span></span><br><span class="line">    implementation <span class="string">'com.google.code.gson:gson:2.2.4'</span></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    implementation <span class="string">'com.github.bumptech.glide:glide:4.6.1'</span></span><br><span class="line">    annotationProcessor <span class="string">'com.github.bumptech.glide:compiler:4.6.1'</span></span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上記コードを追加後、<font color="blue"><strong>Sync Now</strong></font>をクリックして<strong>Glide</strong>の導入は完了です。<br><strong>Glide</strong>の最新版(バージョン4.6.1)を使用する際には<code>dependencies</code>内の<code>implementation &#39;com.android.support:appcompat-v7...&#39;</code>と<code>implementation &#39;com.android.support:design...&#39;</code>の指定バージョンを”27.0.2”に設定する必要があるため、合わせて”compileSdkVersion”、”targetSdkVersion”の指定を<strong>27</strong>に設定しなければいけません。</p>
<p>これは<strong>Glide</strong>が依存関係を持っているandroid.supportバージョンが<strong>27</strong>であることが原因で、<strong>Glide</strong>の古いバージョンの場合には開発アプリ側の”compileSdkVersion”、”targetSdkVersion”を古いものでも実装が可能だと思われます。</p>
<p>では<strong>Glide</strong>を使って蔵書詳細画面のImageViewに画像を読み込ませてみます。<br><figure class="highlight java"><figcaption><span>DetailFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DetailFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定数</span></span><br><span class="line">    <span class="comment">// データ渡しのキー情報</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String BUNDLE_KEY = <span class="string">"BUNDLE_SELFLINK"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// xmlファイルのコンポーネントと関連付ける要素</span></span><br><span class="line">    <span class="keyword">private</span> TextView titleText;</span><br><span class="line">    <span class="keyword">private</span> TextView subTitleText;</span><br><span class="line">    <span class="keyword">private</span> TextView authorText;</span><br><span class="line">    <span class="keyword">private</span> TextView descriptText;</span><br><span class="line">    <span class="keyword">private</span> TextView pageText;</span><br><span class="line">    <span class="keyword">private</span> TextView publishDateText;</span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="keyword">private</span> ImageView detailImage;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">    <span class="comment">// 個体リンクのURL</span></span><br><span class="line">    <span class="keyword">private</span> String selfLink;</span><br><span class="line">  </span><br><span class="line">    ...一部省略</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityCreated</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">       </span><br><span class="line">       ...一部省略</span><br><span class="line">        publishDateText = getView().findViewById(R.id.DetailPublishDateText);</span><br><span class="line">        <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">        detailImage = getView().findViewById(R.id.DetailImage);</span><br><span class="line">        <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line"></span><br><span class="line">       ...一部省略</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// REST APIで取得したデータを画面に反映するためのクラス</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectDetail</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">       ...一部省略</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Handlerから実行されるメソッド</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">           ...一部省略</span><br><span class="line">    </span><br><span class="line">            <span class="comment">// 発売日が取得できていたら反映</span></span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(detailData.volumeInfo.publishedDate)) &#123;</span><br><span class="line">                publishDateText.setText(detailData.volumeInfo.publishedDate);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">            <span class="comment">// Glideを使ってWeb上の画像をImageViewに表示させる</span></span><br><span class="line">            <span class="keyword">if</span> (detailData.volumeInfo.imageLinks != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Glide.with(DetailFragment.<span class="keyword">this</span>)</span><br><span class="line">                        .applyDefaultRequestOptions(RequestOptions.fitCenterTransform())</span><br><span class="line">                        .load(detailData.volumeInfo.imageLinks.medium)</span><br><span class="line">                        .into(detailImage);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上記コードを実装したら動作確認します。<br>正常に動作した場合、蔵書詳細画面に蔵書の表紙画像が表示されます。</p>
<p><strong>Glide</strong>はメソッドからメソッドに繋げる形の実装でも画像のURLをImageViewに表示することができます。（変数を挟まなくていいのでコード量が少なくなります）<br><code>with()</code>ではContextを取得できるインスタンスを引数にセットします、<code>load()</code>の引数には画像のURLをセット、最後に<code>into()</code>の引数に画像を表示するImageViewをセットして表示します。<br><code>applyDefaultRequestOptions()</code>は画像の表示設定を指定できます、今回は画像をはい出さずに表示するように”fitCenterTransform”を指定しています。</p>
<p>以上で、蔵書詳細画面作成の解説は完了です。<br>次の<a href="/AndroidCourse/android/10-OrganaizeExperience">操作性・ユーザ体験の改善</a>ではユーザがアプリを操作する中で気持ちよく操作するための手段として読み込み中を伝えるダイアログや、最後に検索した内容を保持しておくための設定ファイルなどの利用方法を学習します。</p>
</div><!-- comment system--><div class="container"><hr></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© 2018 <a href="/" rel="nofollow">kuririnz</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-63175607-3');ga('send','pageview');</script></html>