<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>蔵書詳細の元ウェブページの表示 | Android programing getstart</title><link rel="stylesheet" type="text/css" href="/AndroidCourse//css/normalize.css"><link rel="stylesheet" type="text/css" href="/AndroidCourse//css/highlight.css"><link rel="stylesheet" type="text/css" href="/AndroidCourse//css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="../../favicon.ico"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="../../." class="title">Android programing getstart</a><span class="subtitle"></span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="../../index.html" class="sidebar-nav-item">Home</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>蔵書詳細の元ウェブページの表示</h1></div></div>
<article><div class="container post"><p>蔵書詳細の元となるウェブページを表示する中でWebViewを使ったWebページの実装を学習します。</p>
<!-- toc -->
<ul>
<li><a href="#学習ポイント">学習ポイント</a></li>
<li><a href="#webview-と-chrome-custom-tabs">WebView と Chrome Custom Tabs</a><ul>
<li><a href="#メリット-デメリット">メリット &amp; デメリット</a></li>
</ul>
</li>
<li><a href="#webview表示の実装">WebView表示の実装</a><ul>
<li><a href="#1detaildatamodelクラスを編集">1.DetailDataModelクラスを編集</a></li>
<li><a href="#2webview表示fragmentの実装">2.WebView表示Fragmentの実装</a><ul>
<li><a href="#レイアウト作成">レイアウト作成</a></li>
<li><a href="#btwebviewfragment実装">BTWebViewFragment実装</a></li>
</ul>
</li>
<li><a href="#3detailfragmentクラス-webview表示fragmentへの遷移ボタンを配置">3.DetailFragmentクラス → WebView表示Fragmentへの遷移ボタンを配置</a></li>
</ul>
</li>
<li><a href="#既存のブラウザアプリでウェブページを表示する">既存のブラウザアプリでウェブページを表示する</a></li>
<li><a href="#chrome-custom-tabs">Chrome Custom Tabs</a></li>
<li><a href="#webviewでのurlハンドリング">WebViewでのURLハンドリング</a></li>
</ul>
<!-- tocstop -->
<p><a href="/AndroidCourse/android/10-OrganiseExperience">操作性・ユーザ体験の改善</a>からの引き続きの学習ページです。</p>
<h1><span id="学習ポイント">学習ポイント</span></h1><ul>
<li>WebView実装の基礎</li>
<li>既存のブラウザアプリで指定のURLを表示</li>
<li>Chrome Custom Tabs</li>
</ul>
<p>Androidアプリにて自身(または法人)で管理している既存のホームページなどを表示したいなどの場合があります。<br>その場合にAndroidではアプリ内で表示する方法、またはAndroidデバイスにインストールされたブラウザアプリ(Chromeやmobile safari)にURLを教えて表示する２つの方法があります。<br>本ページでは上記２つの機能を実装しながら機能を学習します。</p>
<h1><span id="webview-と-chrome-custom-tabs">WebView と Chrome Custom Tabs</span></h1><p>最近はAndroidに置いてChrome Custom TabsというWebViewやChromeアプリより高速な表示を行えるコンポーネントも出てきました、これには一部デメリットもあるのですが、非常に高速でセキュリティ面を考慮したコンポーネントになっています。</p>
<h2><span id="メリット-amp-デメリット">メリット &amp; デメリット</span></h2><table>
<thead>
<tr>
<th style="text-align:left">コンポーネント</th>
<th>メリット</th>
<th>デメリット</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">WebView</td>
<td>・URL毎のハンドリング可 <br> ・javascriptの実行可</td>
<td>・ソーシャルログイン不可</td>
</tr>
<tr>
<td style="text-align:left">Chrome Custom Tabs</td>
<td>・表示が早い <br> ・ソーシャルログイン可</td>
<td>・URL毎のハンドリング不可 <br> ・javascriptの実行不可</td>
</tr>
</tbody>
</table>
<p>ソーシャルログインに関しては<a href="https://developers.googleblog.com/2016/08/modernizing-oauth-interactions-in-native-apps.html" target="_blank" rel="external">Google Developers</a>でも勧告され2017/4/20よりWebViewでのソーシャルログインは廃止されGoogleのSDKかChrome Custom Tabsでの実装に切り替えるよう支持されています。</p>
<h1><span id="webview表示の実装">WebView表示の実装</span></h1><p>新しくFragmentを作成しレイアウトにWebViewを配置し、幅や高さを設定していきます。<br>今回はProjectウィンドウから<code>Fragment</code>ディレクトリを選択した状態で新規Fragment作成の手順を行います。</p>
<blockquote>
<p>New -&gt; Fragment -&gt; Fragment(Blank)</p>
</blockquote>
<img src="/AndroidCourse/android/11-BrowseWebPage/CrWebViewFragment.png" width="550" title="CreateWebViewFragment">
<table>
<thead>
<tr>
<th>項目</th>
<th>設定値</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fragment Name</td>
<td>BTWebViewFragment</td>
</tr>
<tr>
<td>Create Layout XML?</td>
<td>チェックを<font color="blue">つける</font></td>
</tr>
<tr>
<td>Fragment Layout Name</td>
<td>fragment_btweb_view</td>
</tr>
<tr>
<td>Include fragment factory methods?</td>
<td>チェックを<font color="red">つけない</font></td>
</tr>
<tr>
<td>Include interface callbacks?</td>
<td>チェックを<font color="red">つけない</font></td>
</tr>
<tr>
<td>Source Language</td>
<td>Java</td>
</tr>
</tbody>
</table>
<p><strong>WebViewでの表示を行うために現状からは以下３つの修正が必要になります。</strong></p>
<ol>
<li>Modelクラス(DetailDataModel.java)にWebページリンクを取得するパラメータ(変数)を追加</li>
<li>WebView表示Fragmentの実装</li>
<li>DetailFragmentクラス → WebView表示Fragmentへの遷移ボタンを配置</li>
</ol>
<h2><span id="1detaildatamodelクラスを編集">1.DetailDataModelクラスを編集</span></h2><p>WebViewへのURLを調べるために<a href="https://www.googleapis.com/books/v1/volumes/zgkQ8p4zUPsC" target="_blank" rel="external">Google Androidアプリ開発ガイド</a>の蔵書単体情報を取得するAPIの検索結果を確認します。<br>APIの結果には<strong>previewLink</strong>、<strong>infoLink</strong>という項目があり、それぞれのURLをさらにブラウザで確認するとGoogle BooksのURLとPlayStoreの書籍画面のURLであることがわかります。<br><img src="/AndroidCourse/android/11-BrowseWebPage/ConfirmParams.png" width="500" title="ConfirmResponse"><br>また２つの情報の階層としては<code>VolumeInfo</code>の中であることがわかりましたので、一旦この項目２つを<code>DetailDataModel</code>クラスのパラメータに追加します。<br><figure class="highlight java"><figcaption><span>DetailDataModel.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 蔵書概要クラス</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VolumeInfo</span> </span>&#123;</span><br><span class="line">	...一部省略</span><br><span class="line">    <span class="comment">// 蔵書サムネイル画像URL</span></span><br><span class="line">    <span class="keyword">public</span> ImageLinks imageLinks;</span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="comment">// Google BooksへのリンクURL</span></span><br><span class="line">    <span class="keyword">public</span> String previewLink;</span><br><span class="line">    <span class="comment">// Play StoreへのリンクURL</span></span><br><span class="line">    <span class="keyword">public</span> String infoLink;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 蔵書サムネイルクラス</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageLinks</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 蔵書小サイズサムネイル</span></span><br><span class="line">    <span class="keyword">public</span> String smallThumbnail;</span><br><span class="line">    <span class="comment">// 蔵書サムネイル</span></span><br><span class="line">    <span class="keyword">public</span> String thumbnail;</span><br><span class="line">    <span class="comment">// 中サイズ表示画像</span></span><br><span class="line">    <span class="keyword">public</span> String medium;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>取得パラメータの追加は完了しました、取得したパラメータのURLは<code>BTWebViewFragment</code>へ遷移する時の連携データとして使用します。</p>
<h2><span id="2webview表示fragmentの実装">2.WebView表示Fragmentの実装</span></h2><p>続いて実際に表示する<code>BTWebViewFragment</code>を実装していきます、レイアウトには<code>WebView</code>コンポーネントを配置し、BTWebViewFragmentクラスにはWebViewでの表示プログラムを実装します。</p>
<h3><span id="レイアウト作成">レイアウト作成</span></h3><p>以下ファイルを開き、テキストエディタモードでレイアウトを編集します。</p>
<blockquote>
<p>app -&gt; res -&gt; layout -&gt; fragment_btweb_view.xml</p>
</blockquote>
<figure class="highlight xml"><figcaption><span>fragment_btweb_view.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">"kuririnz.xyz.bookdiscovery.Fragment.BTWebViewFragment"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓削除↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- <span class="doctag">TODO:</span> Update blank fragment layout --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/hello_blank_fragment"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑削除↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">WebView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/FragmentWebView"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>BTWebViewFragment</code>に置けるレイアウトとしてはWebViewで対象URLのウェブページを表示するだけなので<code>WebView</code>コンポーネントをは配置し画面全体に表示して完了です。<br><code>FrameLayout</code>は他のLayout(LinearLayout,RelativeLayout,ConstraintLayout)と違い子Viewを配置するための便利な機能を持ち合わせていないことが特徴で、<br>今回のように単純なレイアウトであったり、表示座標を固定して表示したい場合にのみ<code>FrameLayout</code>コンポーネントを使用することをお勧めします。</p>
<h3><span id="btwebviewfragment実装">BTWebViewFragment実装</span></h3><p><code>BTWebViewFragment</code>クラスは蔵書詳細画面から表示するURLデータを連携してもらい、<br>アプリ内のWebViewで表示するための設定をしてからURLの読み込みを開始するよう実装します。<br><figure class="highlight java"><figcaption><span>BTWebViewFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BTWebViewFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="comment">// データ連携用定数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String BUNDLE_URL = <span class="string">"BUNDLE_URL"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// バインドコンポーネント</span></span><br><span class="line">    <span class="keyword">private</span> WebView webview;</span><br><span class="line">    <span class="comment">// メンバ変数</span></span><br><span class="line">    <span class="keyword">private</span> String defaultUrl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// スタティックコンストラクタ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BTWebViewFragment <span class="title">getInstance</span><span class="params">(String previewLink)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// BTWebViewFragmentインスタンスを生成</span></span><br><span class="line">        BTWebViewFragment fragment = <span class="keyword">new</span> BTWebViewFragment();</span><br><span class="line">        <span class="comment">// BTWebViewFragmentへデータを渡すためのBundleを初期化</span></span><br><span class="line">        Bundle args = <span class="keyword">new</span> Bundle();</span><br><span class="line">        <span class="comment">// Google Booksのウェブページリンクをデータ渡し</span></span><br><span class="line">        args.putString(BUNDLE_URL, previewLink);</span><br><span class="line">        <span class="comment">// データ格納クラスをBTWebViewFragmentインスタンスにセット</span></span><br><span class="line">        fragment.setArguments(args);</span><br><span class="line">        <span class="comment">// 生成したFragmentを返却</span></span><br><span class="line">        <span class="keyword">return</span> fragment;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line"></span><br><span class="line">    ...一部省略</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container,</span></span></span><br><span class="line"><span class="function"><span class="params">                             Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Inflate the layout for this fragment</span></span><br><span class="line">        <span class="keyword">return</span> inflater.inflate(R.layout.fragment_web_view, container, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityCreated</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onActivityCreated(savedInstanceState);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遷移時の連携データを取得</span></span><br><span class="line">        <span class="keyword">if</span> (getArguments() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 遷移時に登録したKeyValueデータがない場合はGoogleページを表示</span></span><br><span class="line">            defaultUrl = getArguments().getString(BUNDLE_URL, <span class="string">"https://www.google.co.jp/"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// レイアウトのコンポーネントをバインド</span></span><br><span class="line">        webview = getView().findViewById(R.id.FragmentWebView);</span><br><span class="line">        <span class="comment">// 自身のWebViewで表示するためにWebViewClientをWebViewに設定</span></span><br><span class="line">        webview.setWebViewClient(<span class="keyword">new</span> WebViewClient());</span><br><span class="line">        <span class="comment">// URLの読み込み</span></span><br><span class="line">        webview.loadUrl(defaultUrl);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>これで<code>BTWebViewFragment</code>クラスの実装も完了です。</p>
<h2><span id="3detailfragmentクラス-webview表示fragmentへの遷移ボタンを配置">3.DetailFragmentクラス → WebView表示Fragmentへの遷移ボタンを配置</span></h2><p>最後に<strong>DetailFragment</strong>から<code>BTWebViewFragment</code>へ遷移するためのボタンを配置し、遷移するためのコードを実装します。<br>以下のようなレイアウトになるように実装します。<br><img src="/AndroidCourse/android/11-BrowseWebPage/UpdateDetailLayout01.png" width="250" title="UpdateDetailFragment"><br><figure class="highlight xml"><figcaption><span>fragment_detail.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">...一部省略</span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:weightSum</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/DetailImage"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingLeft</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:scaleType</span>=<span class="string">"fitCenter"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:adjustViewBounds</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/DetailSubTitle"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">tools:text</span>=<span class="string">"蔵書サブタイトル"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/DetailAuthor"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginTop</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">tools:text</span>=<span class="string">"蔵書作者名"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/TransitionWebView"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"WebViewで確認"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">...一部省略</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><figcaption><span>DetailFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓修正↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DetailFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line"><span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑修正↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定数</span></span><br><span class="line">    <span class="comment">// データ渡しのキー情報</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String BUNDLE_KEY = <span class="string">"BUNDLE_SELFLINK"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// xmlファイルのコンポーネントと関連付ける要素</span></span><br><span class="line">    <span class="keyword">private</span> TextView titleText;</span><br><span class="line">    <span class="keyword">private</span> TextView subTitleText;</span><br><span class="line">    <span class="keyword">private</span> TextView authorText;</span><br><span class="line">    <span class="keyword">private</span> TextView descriptText;</span><br><span class="line">    <span class="keyword">private</span> TextView pageText;</span><br><span class="line">    <span class="keyword">private</span> TextView publishDateText;</span><br><span class="line">    <span class="keyword">private</span> ImageView detailImage;</span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="keyword">private</span> Button transWebviewBtn;</span><br><span class="line">    <span class="comment">// Play Store リンクURL</span></span><br><span class="line">    <span class="keyword">private</span> String infoLink;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">    <span class="comment">// 個体リンクのURL</span></span><br><span class="line">    <span class="keyword">private</span> String selfLink;</span><br><span class="line"></span><br><span class="line">    ...一部省略</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityCreated</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        ...一部省略</span><br><span class="line">        detailImage = getView().findViewById(R.id.DetailImage);</span><br><span class="line">        <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">        transWebviewBtn = getView().findViewById(R.id.TransitionWebView);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// BTWebViewFragmentへの遷移処理を実装</span></span><br><span class="line">        transWebviewBtn.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line"></span><br><span class="line">        ...一部省略</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="comment">// JsonパースライブラリGsonのインスタンス化</span></span><br><span class="line">                Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">                <span class="comment">// 返却されたJson文字列を一旦変数に代入</span></span><br><span class="line">                String jsonString = response.body().string();</span><br><span class="line">                <span class="comment">// DetailDataModelクラスに代入</span></span><br><span class="line">                DetailDataModel detailData = gson.fromJson(jsonString, DetailDataModel.class);</span><br><span class="line">                <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">                <span class="comment">// Play Store へのリンクを代入</span></span><br><span class="line">                infoLink = detailData.volumeInfo.infoLink;</span><br><span class="line">                <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">                <span class="comment">// パースが正常に行えたかLogcatに出力して確認。</span></span><br><span class="line">                Log.d(<span class="string">"DetailFragment parse"</span>, detailData.volumeInfo.title);</span><br><span class="line">                <span class="comment">// MainThreadに処理を渡し画面にデータを反映する</span></span><br><span class="line">                handler.post(<span class="keyword">new</span> ReflectDetail(detailData));</span><br><span class="line">            &#125;</span><br><span class="line">        ...一部省略</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="comment">// ボタンクリック時のイベントを実装</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// クリックされたボタンをIDで判定</span></span><br><span class="line">        <span class="keyword">if</span> (view.getId() == R.id.TransitionWebView) &#123;</span><br><span class="line">            <span class="comment">// "WebViewで確認"ボタンをクリックした場合</span></span><br><span class="line">            <span class="comment">// BTWebViewFragmentをインスタンス化</span></span><br><span class="line">            BTWebViewFragment fragment = BTWebViewFragment.getInstance(infoLink);</span><br><span class="line">            <span class="comment">// 別のFragmentに遷移するためのクラスをインスタンス化</span></span><br><span class="line">            FragmentTransaction ft = getFragmentManager().beginTransaction();</span><br><span class="line">            <span class="comment">// 現在、DetailFragmentを表示しているR.id.FragmentContainerをBTWebViewFragmentに置き換え</span></span><br><span class="line">            ft.replace(R.id.FragmentContainer, fragment);</span><br><span class="line">            <span class="comment">// 表示していたFragmentをバックスタックに追加</span></span><br><span class="line">            ft.addToBackStack(<span class="keyword">null</span>);</span><br><span class="line">            <span class="comment">// 変更を反映</span></span><br><span class="line">            ft.commit();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">    ...一部省略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上記の通り、実装を進めると以下の箇所でエラーが出てくると思われます。</p>
<blockquote>
<p>ft.replace(R.id.FragmentContainer, fragment);</p>
</blockquote>
<p>原因は<code>BTWebViewFragment</code>クラスで継承している<strong>Fragment</strong>クラスの問題になります。<br>以前に<a href="/AndroidCourse/android/09-RefactorFragment">蔵書詳細画面作成</a>でFragmentクラスは以下の２種類あると解説をしました。</p>
<blockquote>
<p>Android SDK上にはFragmentクラスが２種類あります。</p>
<ul>
<li>android.app.Fragment</li>
<li>android.support.v4.app.Fragment</li>
</ul>
</blockquote>
<p>DetailFragmentが継承しているFragmentは<strong>android.support.v4.app.Fragment</strong>になっているため、<code>getFragmentManager()</code>メソッドで取得できるFragmentManagerクラスは<strong>support.v4のFragment</strong>クラスだけということになります。<br>AppCompatAcvitiyクラスでは<code>getFragmentManager()</code>と<code>getSupportFragmentManager()</code>の２つメソッドがありFragmentとの関連は以下の通りになります。</p>
<ul>
<li>getFragmentManager() -&gt; android.app.Fragment管理用</li>
<li>getSupportFragmentManager() -&gt; android.support.v4.app.Fragment管理用</li>
</ul>
<p>ということになります、気になる場合は<code>ResultListActivity</code>の実装を確認してみてください。<br>ではDetailFragmentのエラーを解消するために<code>BTWebViewFragment</code>を修正します。<br><figure class="highlight java"><figcaption><span>BTWebViewFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> kuririnz.xyz.bookdiscovery.Fragment;</span><br><span class="line"></span><br><span class="line"><span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓削除↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line"><span class="keyword">import</span> android.app.Fragment;</span><br><span class="line"><span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑削除↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line"><span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line"><span class="keyword">import</span> android.support.v4.app.Fragment;</span><br><span class="line"><span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.annotation.Nullable;</span><br><span class="line"><span class="keyword">import</span> android.view.LayoutInflater;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.webkit.WebView;</span><br><span class="line"><span class="keyword">import</span> android.webkit.WebViewClient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> kuririnz.xyz.bookdiscovery.R;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 蔵書詳細情報のウェブページを表示するFragment</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BTWebViewFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line">    ...一部省略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上記実装ができたら動作確認します。<br>蔵書詳細画面から追加した<strong>WEBVIEWで確認</strong>ボタンをクリックしてアプリ内webViewで表示されることを確認します。</p>
<p><code>BTWebViewFragment</code>クラスの実装でアプリ内のWebViewで指定URLのウェブページを表示することができました、WebView内でリンクをタップするなどして遷移したウェブページでソフトウェアバックボタンをクリックすると蔵書詳細画面に戻ってしまうと思いますが、ハンドリングするためには<code>BTWebViewFragment</code>で<code>onCreateView</code>メソッドでレイアウト生成したViewインスタンスの<strong>setOnKeyLisner</strong>メソッドを実装する必要があります。</p>
<p>また、WebViewをURL毎にハンドリングしたり、表示したウェブページに対してjavascriptのコードを実行する場合などは、<br><code>WebViewClient</code>クラスを継承した自作クラスを作成し、各メソッドをオーバーライドして実装する必要があります。<br><figure class="highlight java"><figcaption><span>BTWebViewFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自身のWebViewで表示するためにWebViewClientをWebViewに設定</span></span><br><span class="line">webview.setWebViewClient(<span class="keyword">new</span> WebViewClient());</span><br></pre></td></tr></table></figure></p>
<p>WebViewでのハンドリング等は当ページの後半で解説します。<br>一旦は指定URLをWebViewで表示する実装に関しては以上になります。</p>
<h1><span id="既存のブラウザアプリでウェブページを表示する">既存のブラウザアプリでウェブページを表示する</span></h1><p>BTWebViewFragmentへの遷移ボタンの下にもう一つボタンを追加し、ブラウザで表示するための機能を実装します。<br>他のアプリを動作させる時の要素としては<code>Intent</code>を使用することを以前のページにも記載していますが、ブラウザでURLを開く場合も<code>Intent</code>を使用して実装します。<br>レイアウトは以下の様になる様に実装します。<br><img src="/AndroidCourse/android/11-BrowseWebPage/UpdateDetailLayout02.png" width="250" title="UpdateDetailFragment"><br><strong>レイアウトの修正</strong><br><figure class="highlight xml"><figcaption><span>fragment_detail.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">...一部省略</span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:weightSum</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/DetailImage"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingLeft</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:scaleType</span>=<span class="string">"fitCenter"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:adjustViewBounds</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/DetailSubTitle"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">tools:text</span>=<span class="string">"蔵書サブタイトル"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/DetailAuthor"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginTop</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">tools:text</span>=<span class="string">"蔵書作者名"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/TransitionWebView"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"WebViewで確認"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/TransitionBrouser"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"ブラウザアプリで確認"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">...一部省略</span><br></pre></td></tr></table></figure></p>
<p><strong>DetailFragment</strong>の実装<br><figure class="highlight java"><figcaption><span>DetailFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DetailFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...一部省略</span><br><span class="line">    <span class="keyword">private</span> Button transWebviewBtn;</span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="keyword">private</span> Button transitionBrowserBtn;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">    <span class="comment">// Play Store リンクURL</span></span><br><span class="line">    <span class="keyword">private</span> String infoLink;</span><br><span class="line">    <span class="comment">// 個体リンクのURL</span></span><br><span class="line">    <span class="keyword">private</span> String selfLink;</span><br><span class="line"></span><br><span class="line">    ...一部省略</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityCreated</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        ...一部省略</span><br><span class="line">        detailImage = getView().findViewById(R.id.DetailImage);</span><br><span class="line">        transWebviewBtn = getView().findViewById(R.id.TransitionWebView);</span><br><span class="line">        <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">        transitionBrowserBtn = getView().findViewById(R.id.TransitionBrowser);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// クリック時にブラウザアプリでURLを表示する処理を実装</span></span><br><span class="line">        transitionBrowserBtn.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">        <span class="comment">// BTWebViewFragmentへの遷移処理を実装</span></span><br><span class="line">        transWebviewBtn.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        ...一部省略</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ボタンクリック時のイベントを実装</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// クリックされたボタンをIDで判定</span></span><br><span class="line">        <span class="keyword">if</span> (view.getId() == R.id.TransitionWebView) &#123;</span><br><span class="line">            <span class="comment">// "WebViewで確認"ボタンをクリックした場合</span></span><br><span class="line">            <span class="comment">// BTWebViewFragmentをインスタンス化</span></span><br><span class="line">            BTWebViewFragment fragment = BTWebViewFragment.getInstance(infoLink);</span><br><span class="line">            <span class="comment">// 別のFragmentに遷移するためのクラスをインスタンス化</span></span><br><span class="line">            FragmentTransaction ft = getFragmentManager().beginTransaction();</span><br><span class="line">            <span class="comment">// 現在、DetailFragmentを表示しているR.id.FragmentContainerをBTWebViewFragmentに置き換え</span></span><br><span class="line">            ft.replace(R.id.FragmentContainer, fragment);</span><br><span class="line">            <span class="comment">// 表示していたFragmentをバックスタックに追加</span></span><br><span class="line">            ft.addToBackStack(<span class="keyword">null</span>);</span><br><span class="line">            <span class="comment">// 変更を反映</span></span><br><span class="line">            ft.commit();</span><br><span class="line">        <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (view.getId() == R.id.TransitionBrowser) &#123;</span><br><span class="line">            <span class="comment">// "ブラウザアプリで確認"ボタンをクリックした場合</span></span><br><span class="line">            <span class="comment">// ブラウザアプリで表示するURLをUriクラスにキャスト</span></span><br><span class="line">            Uri uri = Uri.parse(infoLink);</span><br><span class="line">            <span class="comment">// ブラウザアプリで開くためのIntentをインスタンス化</span></span><br><span class="line">            Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW, uri);</span><br><span class="line">            <span class="comment">// ブラウザアプリで指定URLを表示する</span></span><br><span class="line">            startActivity(intent);</span><br><span class="line">        <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...一部省略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上記コードを実装したら動作確認します。<br>蔵書詳細画面の<strong>ブラウザアプリで確認</strong>ボタンをクリックした時に正常にブラウザアプリが表示またはブラウザアプリの選択ダイアログが表示され、選択したブラウザアプリが立ち上がることを確認します。</p>
<p>Android OSはIntentを受け取ると第二引数のスキーム設定によって表示するアプリを判断します。<br>Intentのコンストラクタの第一引数ではIntentが実行する処理を指定します、今回の第一引数は<code>Intent.ACTION_VIEW</code>を設定しており、この属性は第二引数に設定されるUriデータを処理できるアプリを表示する役割をIntentに与えることができます。</p>
<p>そして、第二引数で渡したUriデータは<code>https://..</code>のURL情報になっておりスキーム箇所は<code>:</code>の前までとして判断してください。<br>今回のスキームは<code>https:</code>となっており、処理できるアプリとしてブラウザアプリ(Chromeなど)を起動するようAndroid OSが判断します、対応するアプリが複数ある場合は表示するアプリを選択するダイアログの様な画面が表示され、ダイアログから選択したアプリが起動します。</p>
<p>電話アプリやメーラーアプリ、自社開発の他アプリを起動することが多く、ほとんどの場合Intentの第一引数は<code>Intent.ACTION_VIEW</code>を設定して使用します。</p>
<p>以上でブラウザアプリでの確認機能の実装解説は終了です。</p>
<h1><span id="chrome-custom-tabs">Chrome Custom Tabs</span></h1><p>ブラウザアプリの様なレイアウトで表示され表示までの処理が最も早いコンポーネントとなる<strong>Chrome Custom Tabs</strong>での確認機能を実装します。</p>
<p><strong>Chrome Custom Tabs</strong>はSupport Libraryに含まれるコンポーネントのため、<code>build.gradle</code>ファイルを修正する必要があります。<br>記述する”customtabs”のバージョン指定は<code>implementation &#39;com.android.support:appcompat-v7:XX.XX.XX&#39;</code>と同じバージョンを指定します。<br>以下は資料作成時のアプリのサンプルです。<br><figure class="highlight gradle"><figcaption><span>build.gradle(Module: app)</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    implementation <span class="keyword">fileTree</span>(dir: <span class="string">'libs'</span>, <span class="keyword">include</span>: [<span class="string">'*.jar'</span>])</span><br><span class="line">    implementation <span class="string">'com.android.support:appcompat-v7:27.0.2'</span></span><br><span class="line">    ...一部省略</span><br><span class="line">    implementation <span class="string">'com.squareup.okhttp3:okhttp:3.9.1'</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.google.code.gson:gson:2.2.4'</span></span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:customtabs:27.0.2'</span></span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>続いてレイアウトは以下の様になる様に実装します。<br><img src="/AndroidCourse/android/11-BrowseWebPage/UpdateDetailLayout03.png" width="250" title="UpdateDetailFragment"><br><strong>レイアウトの修正</strong><br><figure class="highlight xml"><figcaption><span>fragment_detail.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">...一部省略</span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:weightSum</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/DetailImage"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingLeft</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:scaleType</span>=<span class="string">"fitCenter"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:adjustViewBounds</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">            ...一部省略</span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/TransitionWebView"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"WebViewで確認"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/TransitionBrouser"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"ブラウザアプリで確認"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/TransitionCustomTabs"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"ChromeCustomTabsで確認"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">...一部省略</span><br></pre></td></tr></table></figure></p>
<p><strong>DetailFragment</strong>の実装<br><figure class="highlight java"><figcaption><span>DetailFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DetailFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...一部省略</span><br><span class="line">    <span class="keyword">private</span> Button transWebviewBtn;</span><br><span class="line">    <span class="keyword">private</span> Button transitionBrowserBtn;</span><br><span class="line">    <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">    <span class="keyword">private</span> Button transCustomTabsBtn;</span><br><span class="line">    <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">    <span class="comment">// Play Store リンクURL</span></span><br><span class="line">    <span class="keyword">private</span> String infoLink;</span><br><span class="line">    <span class="comment">// 個体リンクのURL</span></span><br><span class="line">    <span class="keyword">private</span> String selfLink;</span><br><span class="line"></span><br><span class="line">    ...一部省略</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityCreated</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        ...一部省略</span><br><span class="line">        detailImage = getView().findViewById(R.id.DetailImage);</span><br><span class="line">        transWebviewBtn = getView().findViewById(R.id.TransitionWebView);</span><br><span class="line">        transitionBrowserBtn = getView().findViewById(R.id.TransitionBrowser);</span><br><span class="line">        <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">        transCustomTabsBtn = getView().findViewById(R.id.TransitionBrowser);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// クリック時にChrome Custom TabsでURLを表示する処理を実装</span></span><br><span class="line">        transCustomTabsBtn.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">        <span class="comment">// クリック時にブラウザアプリでURLを表示する処理を実装</span></span><br><span class="line">        transitionBrowserBtn.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// BTWebViewFragmentへの遷移処理を実装</span></span><br><span class="line">        transWebviewBtn.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        ...一部省略</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ボタンクリック時のイベントを実装</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// クリックされたボタンをIDで判定</span></span><br><span class="line">        <span class="keyword">if</span> (view.getId() == R.id.TransitionWebView) &#123;</span><br><span class="line">            <span class="comment">// "WebViewで確認"ボタンをクリックした場合</span></span><br><span class="line">            <span class="comment">// BTWebViewFragmentをインスタンス化</span></span><br><span class="line">            BTWebViewFragment fragment = BTWebViewFragment.getInstance(infoLink);</span><br><span class="line">            <span class="comment">// 別のFragmentに遷移するためのクラスをインスタンス化</span></span><br><span class="line">            FragmentTransaction ft = getFragmentManager().beginTransaction();</span><br><span class="line">            <span class="comment">// 現在、DetailFragmentを表示しているR.id.FragmentContainerをBTWebViewFragmentに置き換え</span></span><br><span class="line">            ft.replace(R.id.FragmentContainer, fragment);</span><br><span class="line">            <span class="comment">// 表示していたFragmentをバックスタックに追加</span></span><br><span class="line">            ft.addToBackStack(<span class="keyword">null</span>);</span><br><span class="line">            <span class="comment">// 変更を反映</span></span><br><span class="line">            ft.commit();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (view.getId() == R.id.TransitionBrowser) &#123;</span><br><span class="line">            <span class="comment">// "ブラウザアプリで確認"ボタンをクリックした場合</span></span><br><span class="line">            <span class="comment">// ブラウザアプリで表示するURLをUriクラスにキャスト</span></span><br><span class="line">            Uri uri = Uri.parse(infoLink);</span><br><span class="line">            <span class="comment">// ブラウザアプリで開くためのIntentをインスタンス化</span></span><br><span class="line">            Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW, uri);</span><br><span class="line">            <span class="comment">// ブラウザアプリで指定URLを表示する</span></span><br><span class="line">            startActivity(intent);</span><br><span class="line">        <span class="comment">//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓追加↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (view.getId() == R.id.TransitionCustomTabs) &#123;</span><br><span class="line">            <span class="comment">// "ChromeCustomTabsで確認"ボタンをクリックした場合</span></span><br><span class="line">            <span class="comment">// ブラウザアプリで表示するURLをUriクラスにキャスト</span></span><br><span class="line">            Uri uri = Uri.parse(infoLink);</span><br><span class="line">            <span class="comment">// Chrome Custom Tabsをインスタンス化</span></span><br><span class="line">            CustomTabsIntent tabsIntent = <span class="keyword">new</span> CustomTabsIntent.Builder()</span><br><span class="line">                    .setShowTitle(<span class="keyword">true</span>)</span><br><span class="line">                    .build();</span><br><span class="line">            <span class="comment">// Custom Tabsを表示</span></span><br><span class="line">            tabsIntent.launchUrl(getActivity(), uri);</span><br><span class="line">        <span class="comment">//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑追加↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...一部省略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>以上のコードを実装したら動作確認します。<br>蔵書詳細画面の<strong>ChromeCustomTabsで確認</strong>ボタンをクリックした時に正常にChrome Custom Tabsが表示、またはブラウザアプリの選択ダイアログが表示され、選択した後にChrome Custom Tabsが表示されることが確認できると思います。</p>
<p>Chrome Custom Tabsは特殊なコンポーネントになっており、”Intent”に関しても<code>CustomTabsIntent</code>クラスを使います、このクラスの初期化は”Builderパターン”という形式で初期化する形式になっています。<br>今回はウェブページのタイトルを表示するオプション設定を行いましたが、他にも起動/終了時のアニメーションなど設定可能項目がいくつか存在します。<br>さらにIntentを起動する場合は初期化した<code>CustomTabsIntent</code>から<code>launchUrl</code>メソッドを使いChrome Custom Tabsで対象URLのウェブページを表示します。</p>
<p>以上でChrome Custom Tabsの実装解説は終了です。</p>
<h1><span id="webviewでのurlハンドリング">WebViewでのURLハンドリング</span></h1><p>AndroidアプリでWebViewを使う場合、多くの場合は個人(または法人)の管理サイト、またはサービス対象のウェブページに限った範囲でウェブページリンク遷移する場合は開発者が管理できます。<br>しかし、外部のウェブページなどにもアクセスできてしまう場合、開発者が管理できない場面(ブラウザアプリはログインできるが、WebViewではできないなど)が考えられるため、管理外のURLの表示などはブラウザアプリを起動したり、特定のURLを表示しようとした場合に管理内のURLを表示させるなどのハンドリング（ある状況における処理）を行うことが必要になります。</p>
<p>そのためには<code>WebViewClient</code>クラスを継承した自作クラスを作成し、各メソッドをカスタマイズして実装する必要があります。<br>WebViewが次に読み込むURLを判別した後は<code>WebViewClient</code>のActivityやFragmentのライフサイクルと似た形でメソッドが実行されます。<br>実行されるメソッドは多いのでよく使うメソッドをいくつか紹介します。</p>
<table>
<thead>
<tr>
<th>メソッド名</th>
<th style="text-align:left">実行されるタイミング</th>
</tr>
</thead>
<tbody>
<tr>
<td>shouldInterceptRequest(WebView, String)</td>
<td style="text-align:left">・API Level 23- <br> ・画像等リソース読み込み時</td>
</tr>
<tr>
<td>shouldInterceptRequest(WebView, WebResourceRequest)</td>
<td style="text-align:left">・API Level 24+ <br> ・画像等リソース読み込み時</td>
</tr>
<tr>
<td>shouldOverrideUrlLoading(WebView, String)</td>
<td style="text-align:left">・API Level 23- <br> ・次回読み込みURL確定時(読み込み前)</td>
</tr>
<tr>
<td>shouldOverrideUrlLoading(WebView, WebResourceRequest)</td>
<td style="text-align:left">・API Level 24+ <br> ・次回読み込みURL確定時(読み込み前)</td>
</tr>
<tr>
<td>onPageStarted(WebView, String, Bitmap)</td>
<td style="text-align:left">HTML表示開始時</td>
</tr>
<tr>
<td>onLoadResource(WebView, String)</td>
<td style="text-align:left">HTML表示中の画像等表示時</td>
</tr>
<tr>
<td>onPageFinished(WebView, String)</td>
<td style="text-align:left">HTML表示終了時</td>
</tr>
</tbody>
</table>
<p>多くの場合には<code>shouldOverrideUrlLoading()</code>メソッドをオーバーライドしてカスタマイズすることで期待通りの動作に仕上げられると思います。<br>各メソッドの引数にはURL情報が含まれているのでURLを元に<strong>条件分岐 if構文</strong>などを使いハンドリングすることができます。</p>
<p><code>shouldOverrideUrlLoading()</code>や<code>shouldInterceptRequest()</code>メソッドは古いバージョンもサポート対象都する場合は2つのメソッドまたは第二引数が<strong>String</strong>型のメソッドを実装する必要があります。<br>ただ、第二引数が<strong>String</strong>型のメソッドは<font color="red"><strong>deprecated(廃止予定)</strong></font>となっているため、サポート対象とするOSバージョンをAPI level 24以上にしてしまうことも検討すると良いと思います。</p>
<p>今回の蔵書検索アプリの資料の中では実際に実装箇所は含んでいませんが、表示するウェブページで実行できるプログラム<strong>javascript</strong>をアプリから実行することで、ウェブページ上のデータを取得したり、表示内容を変更することもできます。<br>実行の手順としては以下の通りです。</p>
<ol>
<li><p>WebViewインスタンスで<strong>javascript</strong>の実行を有効化<br>最初の<code>webView.loadUrl()</code>メソッドを実行する前に設定します。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webview.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>shouldOverrideUrlLoading()</code>メソッドで”javascript”のコードを実行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</span><br><span class="line">    <span class="comment">// Android OS 4.4(kitkat)~</span></span><br><span class="line">    webView.evaluateJavascript(<span class="string">"javascript:document.write('JavaScriptが実行!');"</span>, <span class="keyword">new</span> ValueCallback&lt;string&gt;() &#123; ...&#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Andorid OS ~4.3(jelly bean)</span></span><br><span class="line">    webView.loadUrl(<span class="string">"javascript:document.write('JavaScriptが実行!');"</span>);		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>上記の通り、AndroidのOSバージョンによってjavascriptの実行方法に差異があるので注意して実装してください。<br>またAndroid OS 4.4(Kitkat)以降で使えるメソッドでは処理結果を受け取ることも簡単にできる様になっています。</p>
<p>以上で蔵書詳細の元ウェブページの表示の解説は終了です。</p>
</div><!-- comment system--><div class="container"><hr></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© 2018 <a href="/" rel="nofollow">kuririnz</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-63175607-3');ga('send','pageview');</script></html>